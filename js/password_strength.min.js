(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function n(){document.querySelectorAll("#site-navigation, #mobile-menu-control-wrapper").forEach((e=>e.classList.remove("toggled"))),document.querySelector("body").classList.remove("mobile-menu-open"),document.querySelectorAll("#mobile-menu-control-wrapper > button").forEach((e=>e.ariaExpanded="false"))}e.r(t),e.d(t,{a1:()=>n,U8:()=>i,UW:()=>a,D8:()=>d,rG:()=>s});const o=e=>{const t=(e=e.replace(/-/g,"+").replace(/_/g,"/")).length%4;if(t){if(1===t)throw new Error("InvalidLengthError: Input base64url string is the wrong length to determine padding");e+=new Array(5-t).join("=")}return window.atob(e)},r=e=>btoa(String.fromCharCode(...e)),a=e=>(e.challenge=Uint8Array.from(o(e.challenge),(e=>e.charCodeAt(0))),void 0!==e.user&&(e.user={...e.user,id:Uint8Array.from(window.atob(e.user.id),(e=>e.charCodeAt(0)))}),void 0!==e.excludeCredentials&&(e.excludeCredentials=e.excludeCredentials.map((e=>({...e,id:Uint8Array.from(o(e.id),(e=>e.charCodeAt(0)))})))),void 0!==e.allowCredentials&&(e.allowCredentials=e.allowCredentials.map((e=>({...e,id:Uint8Array.from(o(e.id),(e=>e.charCodeAt(0)))})))),e),i=e=>{const t={id:e.id,type:e.type,rawId:r(new Uint8Array(e.rawId)),response:{clientDataJSON:r(new Uint8Array(e.response.clientDataJSON))}};return void 0!==e.response.attestationObject&&(t.response.attestationObject=r(new Uint8Array(e.response.attestationObject))),void 0!==e.response.authenticatorData&&(t.response.authenticatorData=r(new Uint8Array(e.response.authenticatorData))),void 0!==e.response.signature&&(t.response.signature=r(new Uint8Array(e.response.signature))),void 0!==e.response.userHandle&&(t.response.userHandle=r(new Uint8Array(e.response.userHandle))),t};function s(e){document.querySelector("#message").innerHTML=DOMPurify.sanitize(e)}async function d(){document.querySelectorAll(".authenticator_wrapper:not(.hidden)").forEach((e=>{e.classList.add("hidden"),e.classList.add("current-method")})),document.getElementById("logging_in_wrapper").classList.remove("hidden");let e=document.getElementById("loginform"),t=new FormData(e);if(e.querySelectorAll(".hidden [required]").forEach((e=>{e.required=!1})),!e.reportValidity())return!1;await Main.waitForInternet();let n=await FormSubmit.fetchRestApi("login/request_login",t);return n?(console.log(n),window.self!==window.top?(console.log(window.parent.document.getElementById("iframe-loader")),console.log(window.parent.document),console.log(window.parent),window.parent.document.getElementById("iframe-loader").textContent="Succesfully logged in, you may now close this popup",window.parent.sim.restNonce=n.nonce,window.parent.sim.userId=n.id,console.log(window.parent.document.getElementById("iframe-loader")),window.parent.document.querySelectorAll("iframe").forEach((e=>e.remove()))):(document.querySelector("#logging_in_wrapper .status_message").textContent="Succesfully logged in, redirecting...",""==n.redirect?location.reload():location.href=n.redirect),!0):(document.getElementById("logging_in_wrapper").classList.add("hidden"),document.querySelector(".current-method").classList.remove("hidden"),!1)}let l,c=5;async function u(){c++;let e=new FormData,t=document.getElementById("qrcode-wrapper"),n=document.getElementById("login-qr-code");if(6==c){console.log("Refreshing QR code"),c=0,null!=n&&(e.append("token",n.dataset.token),e.append("key",n.dataset.key));let o=await FormSubmit.fetchRestApi("login/get_login_qr_code",e);o?(t.innerHTML=o,s("Scan the QR code to login"),console.log(`New token: ${document.getElementById("login-qr-code").dataset.token}`),console.log(`New key: ${document.getElementById("login-qr-code").dataset.key}`)):(wrapperinnerHTML="",s("QR Code Refresh Failed"))}else{if(console.log("Checking for login permission"),null==n)return;e.append("token",n.dataset.token),e.append("key",n.dataset.key),e.append("old-token",n.dataset.oldtoken);let t=await FormSubmit.fetchRestApi("login/qr_code_scanned",e);t&&function(e){clearInterval(l),s("Succesfully logged in, redirecting..."),Main.showLoader(document.getElementById("qrcode-wrapper")),e.startsWith("http")?location.href=e:location.reload()}(t)}}let m,p=!1,g=!1;async function w(e){document.getElementById("webauthn_wrapper").classList.remove("hidden");let t=document.getElementById("username").value;try{let e=await async function(e,t){t.classList.remove("success"),t.classList.remove("error");try{let n=new FormData;n.append("username",e);let o=await FormSubmit.fetchRestApi("login/auth_start",n);if(!o)throw new Error("Fetching Server Challenge failed");let r=a(o);null!=t&&(t.textContent="Waiting for biometric");let s=await navigator.credentials.get({publicKey:r});null!=t&&(t.textContent="Verifying...");const d=i(s);if(n=new FormData,n.append("publicKeyCredential",JSON.stringify(d)),o=await FormSubmit.fetchRestApi("login/auth_finish",n),!o)throw new Error("Verification failed");return null!=t&&(t.textContent="Verification successfull",t.classList.add("success")),!0}catch(e){return null!=t&&(t.textContent=e,t.classList.add("error")),!1}}(t,document.querySelector("#webauthn_wrapper .status_message"));if(!e)throw new Error("Webauthentication failed");await d()}catch(t){var n;document.getElementById("logging_in_wrapper").classList.add("hidden"),document.querySelector("#webauthn_wrapper").classList.add("hidden"),1==e.length?(s("Authentication failed, please setup an additional login factor."),d()):("No authenticator available"==t.message?n="No biometric login for this device found. <br>Give verification code.":(n="Web authentication failed, please give verification code.",n+='<button type="button" class="button small" id="retry_webauthn" style="float:right;margin-top:-20px;">Retry</button>',console.error("Authentication failure: "+t.message)),s(n),f(e))}}window.PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable().then((e=>{e||console.log("No platform authenticator found. If your OS does not come with one, try using devtools to set one up.")}));let h,y=async e=>{if(window.PublicKeyCredential&&PublicKeyCredential.isConditionalMediationAvailable){if(console.log("Conditional UI is understood by the browser"),!await window.PublicKeyCredential.isConditionalMediationAvailable())return void console.log("Conditional UI is understood by your browser but not available")}else{if(!navigator.credentials.conditionalMediationSupported)return void console.log("Your browser does not implement Conditional UI (are you running the right chrome/safari version with the right flags?)");console.log("This browser understand the old version of Conditional UI feature detection")}null!=m&&(console.log("Cancelling previous request"),m.abort("aborted")),m=new AbortController,m.onAbort=function(e){console.log(e)},m.signal.onAbort=function(e){console.log(e)},"conditional"!=e&&(document.getElementById("usercred_wrapper").classList.add("hidden"),document.getElementById("webauthn_wrapper").classList.remove("hidden"),s("Performing passkey login"));let t=document.getElementById("usercred_wrapper");try{let n=new FormData;n.append("username","");let o=await FormSubmit.fetchRestApi("login/auth_start",n);if(!o)throw new Error("auth_start failed");let r=a(o),l=await navigator.credentials.get({signal:m.signal,publicKey:{challenge:r.challenge},mediation:e});return"conditional"==e&&(t.classList.add("hidden"),document.getElementById("webauthn_wrapper").classList.remove("hidden"),s("Performing passkey login")),await async function(e){if(!p){if(e){p=!0,String.fromCodePoint(...new Uint8Array(e.response.userHandle)),document.querySelector("#webauthn_wrapper .status_message").textContent="Verifying credentials...";const t=i(e);let n=new FormData;return n.append("publicKeyCredential",JSON.stringify(t)),await FormSubmit.fetchRestApi("login/auth_finish",n,!1)?(s("Passkey login succesfull"),await d()):(document.querySelector("#webauthn_wrapper .status_message").textContent="Please authenticate",document.querySelectorAll("#usercred_wrapper").forEach((e=>e.classList.remove("hidden"))),document.querySelectorAll("#webauthn_wrapper").forEach((e=>e.classList.add("hidden"))),s("Passkey login failed, try using your username and password"),!1)}return console.log("Credential returned null"),document.getElementById("usercred_wrapper").classList.remove("hidden"),document.getElementById("webauthn_wrapper").classList.add("hidden"),s("Passkey login failed"),!1}}(l)}catch(n){return"aborted"==n?(console.log("request aborted"),!1):(n.message.includes("A request is already pending.")&&y(e),null!=t&&(t.classList.remove("hidden"),document.getElementById("webauthn_wrapper").classList.add("hidden"),s("Passkey login failed, try using your username and password")),console.log(n),!1)}};function f(e){e.includes("email")&&async function(){s("Sending e-mail... <img id='loader' src='"+sim.loadingGif+"' style='height:30px;margin-top:-6px;float:right;'>");var e=document.getElementById("username").value,t=new FormData;t.append("username",e),s(await FormSubmit.fetchRestApi("login/request_email_code",t,!1)||"Sending e-mail failed")}();for(const n of e)if("webauthn"!=n){var t=document.getElementById(n+"_wrapper");null!=t&&(t.classList.remove("hidden"),t.querySelectorAll("input").forEach((e=>window.setTimeout((()=>e.focus()),0))))}document.querySelector("#login_button").disabled="",document.querySelector("#submit_login_wrapper").classList.remove("hidden")}async function v(){var e=document.getElementById("username").value,t=document.getElementById("password").value;if(""!=e&&""!=t){document.querySelector("#usercred_wrapper .loadergif").classList.remove("hidden"),await Main.waitForInternet();var n=new FormData;n.append("username",e),n.append("password",t);var o,r=await FormSubmit.fetchRestApi("login/check_cred",n);r&&("false"==r?(s("Invalid login, try again"),document.querySelector("#usercred_wrapper .loadergif").classList.add("hidden")):(o=r,document.querySelector("#usercred_wrapper .loadergif").classList.add("hidden"),"string"==typeof o&&o?(document.querySelectorAll("#usercred_wrapper").forEach((e=>e.classList.add("hidden"))),document.getElementById("logging_in_wrapper").classList.remove("hidden"),location.href!=o?location.href=o:Main.hideModals()):o?"object"==typeof o?(document.querySelectorAll("#usercred_wrapper").forEach((e=>e.classList.add("hidden"))),s(""),o.find((e=>"webauthn"==e))?g?w(o):1==o.length?(s("You do not have a valid second login method for this device, please add one."),d()):f(o):f(o)):location.reload():s("Invalid username or password!")))}else s("Please give an username and password!")}function b(e){var t=e.target;"IMG"==e.target.tagName&&(t=e.target.parentNode),"0"==t.dataset.toggle?(t.title="Hide password",t.dataset.toggle="1",t.innerHTML=t.innerHTML.replace("invisible","visible"),t.closest(".password").querySelector('input[type="password"]').type="text"):(t.title="Show password",t.dataset.toggle="0",t.innerHTML=t.innerHTML.replace("visible","invisible"),t.closest(".password").querySelector('input[type="text"]').type="password")}function S(){n(),document.querySelector("body").style.overflowY="hidden",h=document.getElementById("login_modal"),h.style.display="block",h.querySelectorAll(".authenticator_wrapper:not(.hidden)").forEach((e=>e.classList.add("hidden"))),h.querySelector("#usercred_wrapper").classList.remove("hidden"),h.classList.remove("hidden"),window.setTimeout((()=>h.querySelector("#username").focus()),0)}function L(){var e=document.querySelector('[name="pass1"]'),t=document.querySelector('[name="pass2"]'),n=document.querySelector("#pass-strength-result1"),o=document.querySelector("#pass-strength-result2"),r="Strength indicator";""==e.value?(n.textContent=r,n.classList.add("hidden")):_(n),""==t.value?(o.textContent=r,o.classList.add("hidden")):(_(o),""!=e.value&&n.classList.add("hidden"))}function _(e){e.classList.remove("short","bad","good","strong");var t=document.querySelector('[name="pass1"]'),n=document.querySelector('[name="pass2"]');if(t.value!=n.value)e.classList.add("bad"),e.textContent=pwsL10n.mismatch;else switch(wp.passwordStrength.meter(t.value,wp.passwordStrength.userInputDisallowedList(),n.value)){case 2:e.classList.add("bad"),e.textContent=pwsL10n.bad;break;case 3:e.classList.add("good"),e.textContent=pwsL10n.good;break;case 4:e.classList.add("strong"),e.textContent=pwsL10n.strong;break;case 5:e.classList.add("short"),e.textContent=pwsL10n.mismatch;break;default:e.classList.add("short"),e.textContent=pwsL10n.short}e.classList.remove("hidden")}async function q(e){var n=e.target.closest("form");n.querySelector(".submit_wrapper .loadergif").classList.remove("hidden");var o=new FormData(n),r=await(0,t.fetchRestApi)("update_password",o);r&&(Main.displayMessage(r.message),location.href.includes("?userid=")||(location.href=r.redirect)),n.querySelector(".submit_wrapper .loadergif").classList.add("hidden")}console.log("Login.js loaded"),document.addEventListener("keypress",(function(e){"Enter"===e.key&&null!=document.querySelector("#usercred_wrapper")&&(document.querySelector("#usercred_wrapper").classList.contains("hidden")?document.querySelector("#submit_login_wrapper").classList.contains("hidden")||d():v())})),document.addEventListener("DOMContentLoaded",(()=>{window.PublicKeyCredential?PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable().then((e=>{e?(console.log("Supported."),g=!0):console.log("WebAuthn supported, Platform Authenticator not supported.")})).catch((e=>{console.error("Something went wrong."),console.error(e)})):console.log("Not supported."),document.querySelectorAll(".login.hidden").forEach((e=>{e.classList.remove("hidden")}))})),document.addEventListener("click",(async function(e){var t=e.target;t.matches(".login")?(S(),console.log("Trying silent login"),await y("silent")||(s("Automatic passkey login failed, try using your username and password"),S())):"check_cred"==t.id?v():"login_button"==t.id?d():null!=t.closest(".toggle_pwd_view")?b(e):"password-reset-form"==t.id||"lost_pwd_link"==t.id?async function(e){var t=document.getElementById("username").value;if(""==t)return void Main.displayMessage("Specify your username first","error");let n=e.querySelector("#lost_pwd_link");n.classList.add("hidden");let o=Main.showLoader(n,!1,"Sending e-mail...   "),r=new FormData(e);r.append("username",t);let a=await FormSubmit.fetchRestApi("login/request_pwd_reset",r);a&&Main.displayMessage(a,"success"),o.remove(),n.classList.remove("hidden")}(t.closest("form")):"retry_webauthn"==t.id?(s(""),w([])):"request_account"==t.name?async function(e){var t=e.closest("form");t.querySelector(".loadergif").classList.remove("hidden");var n=new FormData(t),o=await FormSubmit.fetchRestApi("login/request_user_account",n);o&&Main.displayMessage(o),t.reset(),t.querySelector(".loadergif").classList.add("hidden")}(t):null!=t.closest("[name='fingerprintpicture']")?y("silent"):t.matches(".show-login-qr")?(document.getElementById("usercred_wrapper").classList.add("hidden"),s("Fetching QR code..."),Main.showLoader(document.getElementById("qrcode-wrapper").firstChild),u(),l=setInterval(u,5e3)):t.matches(".close-qr")&&(clearInterval(l),s(""),document.getElementById("usercred_wrapper").classList.remove("hidden"),document.getElementById("qrcode-wrapper").innerHTML="")})),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&(()=>{const e=document.querySelector("meta[name=viewport]");if(null!==e){let t=e.getAttribute("content"),n=/maximum\-scale=[0-9\.]+/g;t=n.test(t)?t.replace(n,"maximum-scale=1.0"):[t,"maximum-scale=1.0"].join(", "),e.setAttribute("content",t)}})(),console.log("Password strength.js loaded"),document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll(".changepass").forEach((e=>e.addEventListener("keyup",L))),document.querySelectorAll('[name="update_password"]').forEach((e=>e.addEventListener("click",q))),document.querySelectorAll(".toggle_pwd_view").forEach((e=>e.addEventListener("click",b)))}))})();
//# sourceMappingURL=password_strength.min.js.map