(()=>{"use strict";async function e(e,t,n=!0){let r;t.append("_wpnonce",sim.restNonce);let a=await fetch(`${sim.baseUrl}/wp-json${sim.restApiPrefix}/login/${e}`,{method:"POST",credentials:"same-origin",body:t});try{r=await a.json()}catch(e){return console.error(a),console.error(e),!1}return a.ok?r:"rest_cookie_invalid_nonce"==r.code?(Main.displayMessage("Please refresh the page and try again!","error"),console.error(r),console.error(`/login/${e}`),!1):(console.error(r),n&&Main.displayMessage(r.message,"error"),console.error(`/login/${e}`),!1)}const t=e=>{const t=(e=e.replace(/-/g,"+").replace(/_/g,"/")).length%4;if(t){if(1===t)throw new Error("InvalidLengthError: Input base64url string is the wrong length to determine padding");e+=new Array(5-t).join("=")}return window.atob(e)},n=e=>btoa(String.fromCharCode(...e)),r=e=>(e.challenge=Uint8Array.from(t(e.challenge),(e=>e.charCodeAt(0))),void 0!==e.user&&(e.user={...e.user,id:Uint8Array.from(window.atob(e.user.id),(e=>e.charCodeAt(0)))}),void 0!==e.excludeCredentials&&(e.excludeCredentials=e.excludeCredentials.map((e=>({...e,id:Uint8Array.from(t(e.id),(e=>e.charCodeAt(0)))})))),void 0!==e.allowCredentials&&(e.allowCredentials=e.allowCredentials.map((e=>({...e,id:Uint8Array.from(t(e.id),(e=>e.charCodeAt(0)))})))),e),a=e=>{const t={id:e.id,type:e.type,rawId:n(new Uint8Array(e.rawId)),response:{clientDataJSON:n(new Uint8Array(e.response.clientDataJSON))}};return void 0!==e.response.attestationObject&&(t.response.attestationObject=n(new Uint8Array(e.response.attestationObject))),void 0!==e.response.authenticatorData&&(t.response.authenticatorData=n(new Uint8Array(e.response.authenticatorData))),void 0!==e.response.signature&&(t.response.signature=n(new Uint8Array(e.response.signature))),void 0!==e.response.userHandle&&(t.response.userHandle=n(new Uint8Array(e.response.userHandle))),t};async function o(){document.querySelectorAll(".authenticator_wrapper:not(.hidden)").forEach((e=>{e.classList.add("hidden"),e.classList.add("current-method")})),document.getElementById("logging_in_wrapper").classList.remove("hidden");var t=document.getElementById("loginform"),n=new FormData(t);if(t.querySelectorAll(".hidden [required]").forEach((e=>{e.required=!1})),t.reportValidity()){await Main.waitForInternet();var r=await e("request_login",n);r?(document.querySelector("#logging_in_wrapper .status_message").textContent="Succesfully logged in, redirecting...",r.startsWith("http")?location.href=r:location.reload()):(document.getElementById("logging_in_wrapper").classList.add("hidden"),document.querySelector(".current-method").classList.remove("hidden"))}}async function s(t){document.getElementById("webauthn_wrapper").classList.remove("hidden");var n=document.getElementById("username").value;try{var s=new FormData;s.append("username",n);var i=await e("auth_start",s);if(!i)throw new Error("auth_start failed");var l=r(i);document.querySelector("#webauthn_wrapper .status_message").textContent="Waiting for biometric";var c=await navigator.credentials.get({publicKey:l});document.querySelector("#webauthn_wrapper .status_message").textContent="Verifying...";const t=a(c);if((s=new FormData).append("publicKeyCredential",JSON.stringify(t)),!(i=await e("auth_finish",s)))throw new Error("auth_finish failed");o()}catch(e){var u;document.getElementById("logging_in_wrapper").classList.add("hidden"),document.querySelector("#webauthn_wrapper").classList.add("hidden"),1==t.length?(d("Authentication failed, please setup an additional login factor."),o()):("No authenticator available"==e.message?u="No biometric login for this device found. <br>Give verification code.":(u="Web authentication failed, please give verification code.",u+='<button type="button" class="button small" id="retry_webauthn" style="float:right;margin-top:-20px;">Retry</button>',console.error("Authentication failure: "+e.message)),d(u),g(t))}}async function i(){var t=document.getElementById("username").value,n=document.getElementById("password").value;if(""!=t&&""!=n){document.querySelector("#usercred_wrapper .loadergif").classList.remove("hidden"),await Main.waitForInternet();var r=new FormData;r.append("username",t),r.append("password",n);var a,i=await e("check_cred",r);i&&("false"==i?(d("Invalid login, try again"),document.querySelector("#usercred_wrapper .loadergif").classList.add("hidden")):(a=i,document.querySelector("#usercred_wrapper .loadergif").classList.add("hidden"),"string"==typeof a&&a?(document.querySelectorAll("#usercred_wrapper").forEach((e=>e.classList.add("hidden"))),document.getElementById("logging_in_wrapper").classList.remove("hidden"),location.href!=a?location.href=a:Main.hideModals()):a?"object"==typeof a?(document.querySelectorAll("#usercred_wrapper").forEach((e=>e.classList.add("hidden"))),d(""),a.find((e=>"webauthn"==e))?u?s(a):1==a.length?(d("You do not have a valid second login method for this device, please add one."),o()):g(a):g(a)):location.reload():d("Invalid username or password!")))}else d("Please give an username and password!")}function d(e){document.querySelector("#login_wrapper .message").innerHTML=DOMPurify.sanitize(e)}window.PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable().then((e=>{e||console.log("No platform authenticator found. If your OS does not come with one, try using devtools to set one up.")})),console.log("Login.js loaded");let l,c,u=!1,m=!1,p=async t=>{if(window.PublicKeyCredential&&PublicKeyCredential.isConditionalMediationAvailable){if(console.log("Conditional UI is understood by the browser"),!await window.PublicKeyCredential.isConditionalMediationAvailable())return void console.log("Conditional UI is understood by your browser but not available")}else{if(!navigator.credentials.conditionalMediationSupported)return void console.log("Your browser does not implement Conditional UI (are you running the right chrome/safari version with the right flags?)");console.log("This browser understand the old version of Conditional UI feature detection")}null!=c&&c.abort("aborted"),c=new AbortController,c.onAbort=function(e){},c.signal.onAbort=function(e){},"conditional"!=t&&(document.getElementById("usercred_wrapper").classList.add("hidden"),document.getElementById("webauthn_wrapper").classList.remove("hidden"),d("Performing passkey login"));try{let n=new FormData;n.append("username","");let s=await e("auth_start",n);if(!s)throw new Error("auth_start failed");let i=r(s),l=await navigator.credentials.get({signal:c.signal,publicKey:{challenge:i.challenge,hints:"client-device"},mediation:t});"conditional"==t&&(document.getElementById("usercred_wrapper").classList.add("hidden"),document.getElementById("webauthn_wrapper").classList.remove("hidden"),d("Performing passkey login")),async function(t){if(!m)if(t){m=!0,String.fromCodePoint(...new Uint8Array(t.response.userHandle)),document.querySelector("#webauthn_wrapper .status_message").textContent="Verifying credentials...";const n=a(t);let r=new FormData;if(r.append("publicKeyCredential",JSON.stringify(n)),!await e("auth_finish",r,!1))return document.querySelector("#webauthn_wrapper .status_message").textContent="Please authenticate",document.getElementById("usercred_wrapper").classList.remove("hidden"),document.getElementById("webauthn_wrapper").classList.add("hidden"),void d("Passkey login failed, try using your username and password");d("Passkey login succesfull"),o()}else console.log("Credential returned null"),document.getElementById("usercred_wrapper").classList.remove("hidden"),document.getElementById("webauthn_wrapper").classList.add("hidden"),d("Passkey login failed")}(l)}catch(e){if("aborted"==e)return void console.log("request aborted");e.message.includes("A request is already pending.")&&p(t),null==document.getElementById("usercred_wrapper").closest(".hidden")&&(document.getElementById("usercred_wrapper").classList.remove("hidden"),document.getElementById("webauthn_wrapper").classList.add("hidden"),d("Passkey login failed, try using your username and password")),console.log(e)}};function g(t){t.includes("email")&&async function(){d("Sending e-mail... <img id='loader' src='"+sim.loadingGif+"' style='height:30px;margin-top:-6px;float:right;'>");var t=document.getElementById("username").value,n=new FormData;n.append("username",t),d(await e("request_email_code",n,!1)||"Sending e-mail failed")}();for(const e of t)if("webauthn"!=e){var n=document.getElementById(e+"_wrapper");null!=n&&(n.classList.remove("hidden"),n.querySelectorAll("input").forEach((e=>window.setTimeout((()=>e.focus()),0))))}document.querySelector("#login_button").disabled="",document.querySelector("#submit_login_wrapper").classList.remove("hidden")}function h(e){var t=e.target;"IMG"==e.target.tagName&&(t=e.target.parentNode),"0"==t.dataset.toggle?(t.title="Hide password",t.dataset.toggle="1",t.innerHTML=t.innerHTML.replace("invisible","visible"),t.closest(".password").querySelector('input[type="password"]').type="text"):(t.title="Show password",t.dataset.toggle="0",t.innerHTML=t.innerHTML.replace("visible","invisible"),t.closest(".password").querySelector('input[type="text"]').type="password")}function w(){var e=document.querySelector('[name="pass1"]'),t=document.querySelector('[name="pass2"]'),n=document.querySelector("#pass-strength-result1"),r=document.querySelector("#pass-strength-result2"),a="Strength indicator";""==e.value?(n.textContent=a,n.classList.add("hidden")):y(n),""==t.value?(r.textContent=a,r.classList.add("hidden")):(y(r),""!=e.value&&n.classList.add("hidden"))}function y(e){e.classList.remove("short","bad","good","strong");var t=document.querySelector('[name="pass1"]'),n=document.querySelector('[name="pass2"]');if(t.value!=n.value)e.classList.add("bad"),e.textContent=pwsL10n.mismatch;else switch(wp.passwordStrength.meter(t.value,wp.passwordStrength.userInputDisallowedList(),n.value)){case 2:e.classList.add("bad"),e.textContent=pwsL10n.bad;break;case 3:e.classList.add("good"),e.textContent=pwsL10n.good;break;case 4:e.classList.add("strong"),e.textContent=pwsL10n.strong;break;case 5:e.classList.add("short"),e.textContent=pwsL10n.mismatch;break;default:e.classList.add("short"),e.textContent=pwsL10n.short}e.classList.remove("hidden")}async function f(t){var n=t.target.closest("form");n.querySelector(".submit_wrapper .loadergif").classList.remove("hidden");var r=new FormData(n),a=await e("update_password",r);a&&(Main.displayMessage(a.message),location.href.includes("?userid=")||(location.href=a.redirect)),n.querySelector(".submit_wrapper .loadergif").classList.add("hidden")}document.addEventListener("keypress",(function(e){"Enter"===e.key&&null!=document.querySelector("#usercred_wrapper")&&(document.querySelector("#usercred_wrapper").classList.contains("hidden")?document.querySelector("#submit_login_wrapper").classList.contains("hidden")||o():i())})),document.addEventListener("DOMContentLoaded",(()=>{window.PublicKeyCredential?PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable().then((e=>{e?(console.log("Supported."),u=!0):console.log("WebAuthn supported, Platform Authenticator not supported.")})).catch((e=>{console.error("Something went wrong."),console.error(e)})):console.log("Not supported."),document.querySelectorAll(".login.hidden").forEach((e=>{e.classList.remove("hidden")}))})),document.addEventListener("click",(function(t){var n=t.target;n.matches(".login")?(document.querySelectorAll("#site-navigation, #mobile-menu-control-wrapper").forEach((e=>e.classList.remove("toggled"))),document.querySelector("body").classList.remove("mobile-menu-open"),document.querySelectorAll("#mobile-menu-control-wrapper > button").forEach((e=>e.ariaExpanded="false")),document.querySelector("body").style.overflowY="hidden",l=document.getElementById("login_modal"),l.style.display="block",l.querySelector("#usercred_wrapper").classList.remove("hidden"),l.classList.remove("hidden"),window.setTimeout((()=>l.querySelector("#username").focus()),0)):"check_cred"==n.id?i():"login_button"==n.id?o():null!=n.closest(".toggle_pwd_view")?h(t):"password-reset-form"==n.id||"lost_pwd_link"==n.id?async function(t){var n=document.getElementById("username").value;if(""==n)return void Main.displayMessage("Specify your username first","error");let r=t.querySelector("#lost_pwd_link");r.classList.add("hidden");let a=Main.showLoader(r,!1,"Sending e-mail...   "),o=new FormData(t);o.append("username",n);let s=await e("request_pwd_reset",o);s&&Main.displayMessage(s,"success"),a.remove(),r.classList.remove("hidden")}(n.closest("form")):"retry_webauthn"==n.id?(d(""),s([])):"request_account"==n.name?async function(t){var n=t.closest("form");n.querySelector(".loadergif").classList.remove("hidden");var r=new FormData(n),a=await e("request_user_account",r);a&&Main.displayMessage(a),n.reset(),n.querySelector(".loadergif").classList.add("hidden")}(n):null!=n.closest("[name='fingerprintpicture']")&&p("silent")})),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&(()=>{const e=document.querySelector("meta[name=viewport]");if(null!==e){let t=e.getAttribute("content"),n=/maximum\-scale=[0-9\.]+/g;t=n.test(t)?t.replace(n,"maximum-scale=1.0"):[t,"maximum-scale=1.0"].join(", "),e.setAttribute("content",t)}})(),p("conditional"),console.log("Password strength.js loaded"),document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll(".changepass").forEach((e=>e.addEventListener("keyup",w))),document.querySelectorAll('[name="update_password"]').forEach((e=>e.addEventListener("click",f))),document.querySelectorAll(".toggle_pwd_view").forEach((e=>e.addEventListener("click",h)))}))})();
//# sourceMappingURL=password_strength.min.js.map