{"version":3,"file":"2fa.min.js","mappings":"AAAAA,QAAQC,IAAI,iBAmGZC,SAASC,iBAAiB,oBAAmB,WAE5C,IAAIC,EAAKF,SAASG,cAAc,4BACvB,MAAND,GACFA,EAAGE,UAAUC,OAAO,SAEtB,IAEAL,SAASC,iBAAiB,SAASK,IAClC,IAAIC,EAASD,EAAGC,OAEE,iBAAfA,EAAOC,MAhFX,SAAwBD,GAEvBP,SAASS,iBAAiB,iBAAiBC,SAAQR,GAAIA,EAAGE,UAAUO,IAAI,YAGxE,IAAIC,EAAUZ,SAASa,eAAe,SAASN,EAAOO,OACtDF,EAAQR,UAAUC,OAAO,UAErBU,KAAKC,iBACRJ,EAAQH,iBAAiB,kBAAkBC,SAAQR,GAAIA,EAAGE,UAAUC,OAAO,YAE3EO,EAAQH,iBAAiB,mBAAmBC,SAAQR,GAAIA,EAAGE,UAAUC,OAAO,YAG1D,iBAAhBE,EAAOO,OAETP,EAAOU,QAAQ,QAAQd,cAAc,gBAAgBC,UAAUC,OAAO,SAExE,CA+DEa,CAAeX,GAGbA,EAAOY,QAAQ,qBAhEnBC,eAAsCb,GACrC,IAAIc,EAAUd,EAAOU,QAAQ,SACzBK,EAAUf,EAAOU,QAAQ,MAEzBM,EAAW,IAAIC,SACnBD,EAASE,OAAO,MAAMlB,EAAOmB,QAAQC,KAErCZ,KAAKa,WAAWrB,GAAQ,GAExB,IAAIsB,QAAkBC,WAAWC,aAAa,iCAAkCR,GAE7EM,IACoB,GAAnBR,EAAMW,KAAKC,OACbZ,EAAMhB,SAENiB,EAAIjB,SAGLU,KAAKmB,eAAeL,GAEtB,CA6CEM,CAAuB5B,GAGN,WAAfA,EAAOC,MApHXY,eAAiCb,GAEhC,IAAI6B,EAAS7B,EAAOU,QAAQ,mBAAmBd,cAAc,mBAC7DiC,EAAOhC,UAAUC,OAAO,UAExB,IAAIgC,EAAQ9B,EAAOU,QAAQ,QAM3B,GAJAoB,EAAK5B,iBAAiB,wCAAwCC,SAAQR,IAAKA,EAAGoC,UAAW,KAE1ED,EAAKE,iBAER,CACX,IAAIhB,EAAW,IAAIC,SAASa,GACxBR,QAAkBC,WAAWC,aAAa,0BAA2BR,GAEtEM,IACFQ,EAAK5B,iBAAiB,+BAA+BC,SAAQR,GAAIA,EAAGE,UAAUO,IAAI,YAElFI,KAAKmB,eAAeL,EAAU,WAG9BtB,EAAOU,QAAQ,QAAQd,cAAc,gBAAgBC,UAAUO,IAAI,UAErE,CAEAyB,EAAOhC,UAAUO,IAAI,SACtB,CA2FE6B,CAAkBjC,GAGH,qBAAbA,EAAOkC,IAlDXrB,eAAmCb,GAElC,IAAI6B,EAAYrB,KAAKa,WAAWrB,GAAQ,EAAO,GAAI,IAAI,GAEvDP,SAASa,eAAe,iBAAiB6B,UAAY,qBAAqBN,IAE1E,IAAIO,EAAW3C,SAASa,eAAe,YAAYC,MAC/CS,EAAW,IAAIC,SACnBD,EAASE,OAAO,WAAYkB,GAE5B,IAAId,QAAiBC,WAAWC,aAAa,2BAA4BR,GAEtEM,IACF7B,SAASa,eAAe,iBAAiB6B,UAAYb,EACrD7B,SAASa,eAAe,iBAAiBT,UAAUO,IAAI,WAEvDX,SAASa,eAAe,yBAAyBT,UAAUC,OAAO,UAElEE,EAAOH,UAAUO,IAAI,UAGrBJ,EAAOU,QAAQ,QAAQd,cAAc,gBAAgBC,UAAUC,OAAO,UAEtEL,SAASa,eAAe,yBAAyB+B,QAEnD,CA0BEC,CAAoBtC,EACrB","sources":["webpack://login/./2fa.js"],"sourcesContent":["console.log(\"2fa.js loaded\");\r\n\r\nasync function saveTwofaSettings(target){\r\n\t// Show loader\r\n\tlet loader\t= target.closest('.submit_wrapper').querySelector('.loader_wrapper');\r\n\tloader.classList.remove('hidden');\r\n\r\n\tlet form\t\t= target.closest('form');\r\n\r\n\tform.querySelectorAll('.hidden [required], select[required]').forEach(el=>{el.required = false});\r\n\r\n\tlet validity\t= form.reportValidity();\r\n\r\n\tif(validity){\r\n\t\tlet formData\t= new FormData(form);\r\n\t\tlet response \t= await FormSubmit.fetchRestApi('login/save_2fa_settings', formData);\r\n\r\n\t\tif(response){\r\n\t\t\tform.querySelectorAll('[id^=\"setup-\"]:not(.hidden)').forEach(el=>el.classList.add('hidden'));\r\n\r\n\t\t\tMain.displayMessage(response, 'success');\r\n\r\n\t\t\t//Show submit button\r\n\t\t\ttarget.closest('form').querySelector('.form_submit').classList.add('hidden');\r\n\t\t}\r\n\t}\r\n\r\n\tloader.classList.add('hidden');\r\n}\r\n\r\nfunction showTwofaSetup(target) {\r\n\t//hide all options\r\n\tdocument.querySelectorAll('.twofa_option').forEach(el=>el.classList.add('hidden'));\r\n\r\n\t// Show setup for this method\r\n\tvar wrapper\t= document.getElementById('setup-'+target.value);\r\n\twrapper.classList.remove('hidden');\r\n\r\n\tif (Main.isMobileDevice()){\r\n\t\twrapper.querySelectorAll('.mobile.hidden').forEach(el=>el.classList.remove('hidden'));\r\n\t}else{\r\n\t\twrapper.querySelectorAll('.desktop.hidden').forEach(el=>el.classList.remove('hidden'));\r\n\t}\r\n\r\n\tif(target.value == 'authenticator'){\r\n\t\t//Show submit button\r\n\t\ttarget.closest('form').querySelector('.form_submit').classList.remove('hidden');\r\n\t}\r\n}\r\n\r\nasync function removeWebAuthenticator(target){\r\n\tlet table   = target.closest('table');\r\n\tlet row     = target.closest('tr');\r\n\r\n\tlet formData\t= new FormData();\r\n\tformData.append('key',target.dataset.key);\r\n\r\n\tMain.showLoader(target, true);\r\n\r\n\tlet response \t= await FormSubmit.fetchRestApi('login/remove_web_authenticator', formData);\r\n\r\n\tif(response){\r\n\t\tif(table.rows.length==2){\r\n\t\t\ttable.remove();\r\n\t\t}else{\r\n\t\t\trow.remove();\r\n\t\t}\r\n\r\n\t\tMain.displayMessage(response);\r\n\t}\r\n}\r\n\r\nasync function sendValidationEmail(target){\r\n\t// Request email code for 2fa login setup\r\n\tlet loader\t\t\t\t= Main.showLoader(target, false, 50, '', true);\r\n\r\n\tdocument.getElementById('email-message').innerHTML\t= `Sending e-mail... ${loader}`;\r\n\r\n\tlet username\t= document.getElementById('username').value;\r\n\tlet formData\t= new FormData();\r\n\tformData.append('username', username);\r\n\r\n\tlet response\t= await FormSubmit.fetchRestApi('login/request_email_code', formData);\r\n\r\n\tif(response){\r\n\t\tdocument.getElementById('email-message').innerHTML\t= response;\r\n\t\tdocument.getElementById('email-message').classList.add('success');\r\n\r\n\t\tdocument.getElementById('email-code-validation').classList.remove('hidden');\r\n\r\n\t\ttarget.classList.add('hidden');\r\n\r\n\t\t//Show submit button\r\n\t\ttarget.closest('form').querySelector('.form_submit').classList.remove('hidden');\r\n\r\n\t\tdocument.getElementById('email-code-validation').focus();\r\n\t}\r\n}\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\",function() {\r\n\t//hide the webauthn table if not possible\r\n\tvar el = document.querySelector('#webauthn_wrapper.hidden');\r\n\tif(el != null){\r\n\t\tel.classList.remove('hidden');\r\n\t}\t\r\n});\r\n\r\ndocument.addEventListener('click', ev =>{\r\n\tvar target = ev.target;\r\n\r\n\tif(target.name == '2fa_methods[]'){\r\n\t\tshowTwofaSetup(target);\r\n\t}\r\n\r\n\tif(target.matches('.remove_webauthn')){\r\n\t\tremoveWebAuthenticator(target);\r\n\t}\r\n\r\n\tif(target.name == 'save2fa'){\r\n\t\tsaveTwofaSettings(target);\r\n\t}\r\n\r\n\tif(target.id == 'email-code-button'){\r\n\t\tsendValidationEmail(target);\r\n\t}\r\n})"],"names":["console","log","document","addEventListener","el","querySelector","classList","remove","ev","target","name","querySelectorAll","forEach","add","wrapper","getElementById","value","Main","isMobileDevice","closest","showTwofaSetup","matches","async","table","row","formData","FormData","append","dataset","key","showLoader","response","FormSubmit","fetchRestApi","rows","length","displayMessage","removeWebAuthenticator","loader","form","required","reportValidity","saveTwofaSettings","id","innerHTML","username","focus","sendValidationEmail"],"sourceRoot":""}