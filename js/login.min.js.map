{"version":3,"file":"login.min.js","mappings":"mBAsHO,SAASA,EAAYC,GAClBC,SAASC,cAAc,YAC7BC,UAAWC,UAAUC,SAASL,EAClC,CCrHA,IAAIM,EACAC,EAAe,EA+BnBC,eAAeC,IACdF,IAEG,IAAIG,EAAc,IAAIC,SACrBC,EAAWX,SAASY,eAAe,kBACnCC,EAAcb,SAASY,eAAe,iBAG1C,GAAiB,GAAdN,EAAgB,CAClBQ,QAAQC,IAAI,sBAENT,EAAkB,EAGN,MAAfO,IACFJ,EAASO,OAAO,QAASH,EAAYI,QAAQC,OAC7CT,EAASO,OAAO,MAAOH,EAAYI,QAAQE,MAI5C,IAAIC,QAAoBC,WAAWC,aAAa,0BAA2Bb,GAExEW,GACFT,EAAQT,UAAUkB,EAElBtB,EAAY,6BAEZgB,QAAQC,IAAI,cAAcf,SAASY,eAAe,iBAAiBK,QAAQC,SAC3EJ,QAAQC,IAAI,YAAYf,SAASY,eAAe,iBAAiBK,QAAQE,SAEzEI,iBAAiB,GAEjBzB,EAAY,0BAEd,KAAK,CAGE,GAFNgB,QAAQC,IAAI,iCAEY,MAAfF,EACC,OAIJJ,EAASO,OAAO,QAASH,EAAYI,QAAQC,OAC7CT,EAASO,OAAO,MAAOH,EAAYI,QAAQE,KAC3CV,EAASO,OAAO,YAAaH,EAAYI,QAAQO,UACvD,IAAIJ,QAAiBC,WAAWC,aAAa,wBAAyBb,GAEnEW,GA7DL,SAAeA,GACdK,cAAcpB,GAEdP,EAAY,yCAEZ4B,KAAKC,WAAW3B,SAASY,eAAe,mBAEpCQ,EAASQ,WAAW,QAGvBC,SAASC,KAAOV,EAFhBS,SAASE,QAIX,CAkDGC,CAAMZ,EAER,CACD,CCpFO,SAAS,IACZ,OAAOa,EAAkCC,cAA6CC,IAApCC,YAAYC,qBAChB,mBAAnCD,WAAWC,oBAC1B,CAKO,MAAMJ,EAAoC,CAC7CC,SAAWI,GAAUA,GCKlB,MAAM,UAAsBC,MAC/B,WAAAC,EAAY,QAAEzC,EAAO,KAAE0C,EAAI,MAAEC,EAAK,KAAEC,IAEhCC,MAAM7C,EAAS,CAAE2C,UACjBG,OAAOC,eAAeC,KAAM,OAAQ,CAChCC,YAAY,EACZC,cAAc,EACdC,UAAU,EACVZ,WAAO,IAEXS,KAAKJ,KAAOA,GAAQD,EAAMC,KAC1BI,KAAKN,KAAOA,CAChB,ECOG,MAAM,EAAuB,IApCpC,MACI,WAAAD,GACIK,OAAOC,eAAeC,KAAM,aAAc,CACtCC,YAAY,EACZC,cAAc,EACdC,UAAU,EACVZ,WAAO,GAEf,CACA,oBAAAa,GAEI,GAAIJ,KAAKK,WAAY,CACjB,MAAMC,EAAa,IAAId,MAAM,qDAC7Bc,EAAWV,KAAO,aAClBI,KAAKK,WAAWE,MAAMD,EAC1B,CACA,MAAME,EAAgB,IAAIC,gBAE1B,OADAT,KAAKK,WAAaG,EACXA,EAAcE,MACzB,CACA,cAAAC,GACI,GAAIX,KAAKK,WAAY,CACjB,MAAMC,EAAa,IAAId,MAAM,kDAC7Bc,EAAWV,KAAO,aAClBI,KAAKK,WAAWE,MAAMD,GACtBN,KAAKK,gBAAajB,CACtB,CACJ,GCrBG,SAAS,EAAwBwB,GACpC,MAAMC,EAAQ,IAAIC,WAAWF,GAC7B,IAAIG,EAAM,GACV,IAAK,MAAMC,KAAYH,EACnBE,GAAOE,OAAOC,aAAaF,GAG/B,OADqBG,KAAKJ,GACNK,QAAQ,MAAO,KAAKA,QAAQ,MAAO,KAAKA,QAAQ,KAAM,GAC9E,CCPO,SAAS,EAAwBC,GAEpC,MAAMC,EAASD,EAAgBD,QAAQ,KAAM,KAAKA,QAAQ,KAAM,KAQ1DG,GAAa,EAAKD,EAAOE,OAAS,GAAM,EACxCC,EAASH,EAAOI,OAAOJ,EAAOE,OAASD,EAAW,KAElDI,EAASC,KAAKH,GAEdb,EAAS,IAAIiB,YAAYF,EAAOH,QAChCX,EAAQ,IAAIC,WAAWF,GAC7B,IAAK,IAAIkB,EAAI,EAAGA,EAAIH,EAAOH,OAAQM,IAC/BjB,EAAMiB,GAAKH,EAAOI,WAAWD,GAEjC,OAAOlB,CACX,CCLO,MAAMoB,EACEzC,GAAUA,ECvBlB,SAAS,EAAgC0C,GAC5C,MAAM,GAAEC,GAAOD,EACf,MAAO,IACAA,EACHC,GAAI,EAAwBA,GAM5BC,WAAYF,EAAWE,WAE/B,CCbA,MAAMC,EAAc,CAAC,iBAAkB,YAIhC,SAAS,EAA0BC,GACtC,GAAKA,KAGDD,EAAYE,QAAQD,GAAc,GAGtC,OAAOA,CACX,CCaO7E,eAAe+E,EAAoBC,GACzC,IAEC,IAAI9E,EAAc,IAAIC,SACtBD,EAASO,OAAO,WAAYuE,GAE5B,MAAMC,QAAwBnE,WAAWC,aAAa,mBAAoBb,GAC1E,IAAI+E,EACH,MAAM,IAAIjD,MAAM,oCAIjBkD,IAAIzD,MAAM0D,cAAc,4BAGxB,MAAMC,QCzBDpF,eAAmCqF,IAEjCA,EAAQJ,aAAeI,EAAQC,YAChC/E,QAAQgF,KAAK,gUAEbF,EAAU,CAAEJ,YAAaI,IAE7B,MAAM,YAAEJ,EAAW,mBAAEO,GAAqB,EAAK,2BAAEC,GAA6B,GAAUJ,EACxF,IAAK,IACD,MAAM,IAAIrD,MAAM,6CAIpB,IAAI0D,EACyC,IAAzCT,EAAYS,kBAAkB1B,SAC9B0B,EAAmBT,EAAYS,kBAAkBC,IAAI,IAGzD,MAAMC,EAAY,IACXX,EACHK,UAAW,EAAwBL,EAAYK,WAC/CI,oBAGEG,EAAa,CAAC,EAKpB,GAAIL,EAAoB,CACpB,UJxCD,WACH,IAAK,IACD,OAAOhB,EAAmD,IAAIsB,SAASC,GAAYA,GAAQ,MAQ/F,MAAMC,EAA4BnE,WAC7BC,oBACL,OACW0C,OADwD5C,IAA/DoE,GAA2BC,gCAC+B,IAAIH,SAASC,GAAYA,GAAQ,KAErCC,EAA0BC,kCACxF,CIwBoBC,GACR,MAAMlE,MAAM,8CAKhB,GAFuBvC,SAAS0G,iBAAiB,mCAE9BnC,OAAS,GAAKyB,EAC7B,MAAMzD,MAAM,qGAIhB6D,EAAWO,UAAY,cAEvBR,EAAUF,iBAAmB,EACjC,CAMA,IAAIW,EAJJR,EAAWD,UAAYA,EAEvBC,EAAW3C,OAAS,EAAqBN,uBAGzC,IACIyD,QAAoBC,UAAUC,YAAYC,IAAIX,EAClD,CACA,MAAOY,GACH,MCjED,UAAqC,MAAEC,EAAK,QAAErB,IACjD,MAAM,UAAEO,GAAcP,EACtB,IAAKO,EACD,MAAM5D,MAAM,mDAEhB,GAAmB,eAAf0E,EAAMtE,MACN,GAAIiD,EAAQnC,kBAAkByD,YAE1B,OAAO,IAAI,EAAc,CACrBnH,QAAS,mDACT0C,KAAM,yBACNC,MAAOuE,QAId,IAAmB,oBAAfA,EAAMtE,KAKX,OAAO,IAAI,EAAc,CACrB5C,QAASkH,EAAMlH,QACf0C,KAAM,uCACNC,MAAOuE,IAGV,GAAmB,kBAAfA,EAAMtE,KAA0B,CACrC,MAAMwE,EAAkB/E,WAAWP,SAASuF,SAC5C,GCtBS,eAHaA,EDyBHD,KCrBnB,0CAA0CE,KAAKD,GDuB3C,OAAO,IAAI,EAAc,CACrBrH,QAAS,GAAGqC,WAAWP,SAASuF,gCAChC3E,KAAM,uBACNC,MAAOuE,IAGV,GAAId,EAAUmB,OAASH,EAExB,OAAO,IAAI,EAAc,CACrBpH,QAAS,cAAcoG,EAAUmB,mCACjC7E,KAAM,sBACNC,MAAOuE,GAGnB,MACK,GAAmB,iBAAfA,EAAMtE,KAGX,OAAO,IAAI,EAAc,CACrB5C,QAAS,+GACT0C,KAAM,oCACNC,MAAOuE,GAEf,CClDG,IAAuBG,EDmD1B,OAAOH,CACX,CDUcM,CAA4B,CAAEN,MAAOD,EAAKpB,QAASQ,GAC7D,CACA,IAAKQ,EACD,MAAM,IAAIrE,MAAM,oCAEpB,MAAM,GAAE0C,EAAE,MAAEuC,EAAK,SAAEpG,EAAQ,KAAEqG,GAASb,EACtC,IAAIc,EAKJ,OAJItG,EAASsG,aACTA,EAAa,EAAwBtG,EAASsG,aAG3C,CACHzC,KACAuC,MAAO,EAAwBA,GAC/BpG,SAAU,CACNuG,kBAAmB,EAAwBvG,EAASuG,mBACpDC,eAAgB,EAAwBxG,EAASwG,gBACjDC,UAAW,EAAwBzG,EAASyG,WAC5CH,cAEJD,OACAK,uBAAwBlB,EAAWmB,4BACnCC,wBAAyB,EAA0BpB,EAAWoB,yBAEtE,CDtDmCC,CAAoB,IAAKzC,EAAaO,oBAAoB,IAG3F,IAAImC,EAAYlI,SAASY,eAAe,aAAeZ,SAASY,eAAe,kBAAeuB,EAC9F1B,EAAe,IAAIC,SAASwH,GAC5BzH,EAASO,OAAO,sBAAuBkD,KAAKiE,KAAKC,UAAUzC,KAC3D,IAAIvE,QAAqBC,WAAWC,aAAa,oBAAqBb,GACtE,IAAIW,GAAYA,EAASiH,SACxB,MAAM,IAAI9F,MAAM,uBAKjB,OAFAzC,EAAY,6BAEL,CACR,CAAE,MAAOmH,GAKR,OAJAnG,QAAQmG,MAAM,yBAA0BA,GAExCnH,EAAYmH,IAEL,CACR,CACD,CAlDAqB,OAAOjG,oBAAoBkG,gDAAgDC,MAC1EC,IACOA,GACN3H,QAAQC,IAAI,wGACX,IAuDI,IAAI2H,EAA0BnI,MAAOoG,IAC3C,GAAI2B,OAAOjG,qBAAuBA,oBAAoBmE,iCAErD,GADA1F,QAAQC,IAAI,sDACDuH,OAAOjG,oBAAoBmE,kCAErC,YADA1F,QAAQC,IAAI,sEAGP,CACN,IAAK8F,UAAUC,YAAY6B,8BAE1B,YADA7H,QAAQC,IAAI,0HAGZD,QAAQC,IAAI,8EAEd,CAMA,OAJA0E,IAAIzD,MAAM0D,cAAc,kCAEGJ,EAAoB,KAG9CxF,EAAY,kCAEC2F,IAAIzD,MAAM4G,iBAEvBnD,IAAIzD,MAAM6G,QAEV/I,EAAY,+DAEL,EACR,EAGMS,eAAeuI,IACrB,IAAIC,GAAoB,EAaxB,OAXIT,OAAOjG,0BACYA,oBAAoBkG,gDAEzCQ,GAAoB,EAEpBjI,QAAQC,IAAI,6DAGbD,QAAQC,IAAI,kBAGNgI,CACR,CIpGAjI,QAAQC,IAAI,mBAEZ,MAAM,EAAQ,MACb,WAAAyB,GACCO,KAAKiG,OAMqB,MAJb,IAAIC,MAAM,IAAIC,gBAAgBZ,OAAOzG,SAASsH,QAAS,CACnEpC,IAAK,CAACqC,EAAcC,IAASD,EAAarC,IAAIsC,KAG1B,YACpBvI,QAAQC,IAAI,uBACZ2H,KAGE3F,KAAKuG,YACPvG,KAAKwG,gCAGNxG,KAAKyG,gBACN,CAEA,cAAAA,GACCxJ,SAASyJ,iBAAiB,YAAaC,IACxB,UAAVA,EAAEvI,KAAiC,MAAd4B,KAAK4G,QAC7BD,EAAEE,2BAEC7G,KAAK8G,WAAa9G,KAAK4G,OAA2D,GAAlD3J,SAASY,eAAe,cAAckJ,SACxE/G,KAAKgH,cACGhH,KAAK8G,WAAa9G,KAAKiH,OAASjH,KAAK8G,WAAa9G,KAAKkH,OAC/DlH,KAAK6F,eAEP,IAGD5I,SAASyJ,iBAAiB,SAASlJ,MAAO2J,IACzC,IAAIC,EAASD,EAAMC,OAEnB,GAAGA,EAAOC,QAAQ,UACjBrH,KAAKsH,iBAELvJ,QAAQC,IAAI,4BACP,GAAgB,cAAboJ,EAAOlF,GAEflC,KAAKgH,mBACA,GAAgB,gBAAbI,EAAOlF,GAEflC,KAAK6F,oBACA,GAAyC,MAAtCuB,EAAOG,QAAQ,qBdyDpB,SAA2BC,GACjCA,EAAGX,2BAEH,IAAIO,EAASI,EAAGJ,OAEQ,OAArBI,EAAGJ,OAAOK,UACZL,EAASI,EAAGJ,OAAOM,YAGQ,KAAzBN,EAAOlJ,QAAQyJ,QACjBP,EAAOQ,MAAe,gBACtBR,EAAOlJ,QAAQyJ,OAAc,IAC7BP,EAAOjK,UAAkBiK,EAAOjK,UAAUiE,QAAQ,YAAa,WAC/DgG,EAAOG,QAAQ,aAAarK,cAAc,0BAA0BwH,KAAO,SAE3E0C,EAAOQ,MAAe,gBACtBR,EAAOlJ,QAAQyJ,OAAc,IAC7BP,EAAOjK,UAAkBiK,EAAOjK,UAAUiE,QAAQ,UAAW,aAC7DgG,EAAOG,QAAQ,aAAarK,cAAc,sBAAsBwH,KAAO,WAEzE,Cc5EImD,CAAkBV,QACb,GAAgB,uBAAbC,EAAOlF,IAA4C,iBAAbkF,EAAOlF,GACrDlC,KAAK8H,cAAcV,QACd,GAAgB,kBAAbA,EAAOlF,GACflC,KAAKjD,YAAY,IACjBiD,KAAK+H,eAAe,SACf,GAAkB,mBAAfX,EAAOxH,KACfI,KAAKgI,eAAeZ,QACf,GAAoD,MAAjDA,EAAOG,QAAQ,+BACvB5B,SACK,GAAGyB,EAAOC,QAAQ,kBbpE1BpK,SAASY,eAAe,oBAAoBoK,UAAUC,IAAI,UAE1DnL,EAAY,uBAEZ4B,KAAKC,WAAW3B,SAASY,eAAe,kBAAkBsK,YAG1D1K,IAGAH,EAAa8K,YAAY3K,EAAe,Sa4DhC,KAAG2J,EAAOC,QAAQ,aAGvB,ObQH3I,cAAcpB,GAEdP,EAAY,IAEZE,SAASY,eAAe,oBAAoBoK,UAAUI,OAAO,UAE7DpL,SAASY,eAAe,kBAAkBV,UAAY,EabpD,CAEAgK,EAAMN,0BAA0B,GAElC,CAEA,UAAAN,GACC,MAAO,mBAAmBjC,KAAKR,UAAUwE,aAAe/C,OAAOgD,QAChE,CAEA,IAAAtC,GACCjG,KAAKmF,KAASlI,SAASY,eAAe,aACtCmC,KAAKwI,UAAavL,SAASY,eAAe,mBAC1CmC,KAAK4G,MAAU3J,SAASY,eAAe,uBACvCmC,KAAKkH,MAAUjK,SAASY,eAAe,yBACvCmC,KAAKiH,MAAUhK,SAASY,eAAe,iBACvCmC,KAAKf,MAAUhC,SAASY,eAAe,wBACvCmC,KAAKyI,cAAiBxL,SAASY,eAAe,uBAE9CmC,KAAK8G,UAAa9G,KAAK4G,MAEuB,MAA3C5G,KAAKwI,UAAUtL,cAAc,YAC/ByB,KAAKC,WAAWoB,KAAKwI,UAAUtL,cAAc,oBAAoB,EAAO,GAE1E,CAKA,SAAAwL,GACC1I,KAAK8F,QAEL9F,KAAK2I,WAAW3I,KAAK4G,OAErB5G,KAAK8G,UAAa9G,KAAK4G,KACxB,CAKA,aAAAjE,CAAc3F,GACbgD,KAAKwI,UAAUtL,cAAc,mBAAmB0L,YAAc5L,EAE9DgD,KAAK8G,UAAUmB,UAAUC,IAAI,UAC7BlI,KAAKf,MAAMgJ,UAAUC,IAAI,UACzBlI,KAAKyI,cAAcR,UAAUC,IAAI,UAEjClI,KAAKwI,UAAUP,UAAUI,OAAO,SACjC,CAKA,KAAAvC,GACsB1G,MAAlBY,KAAK8G,YAIR9G,KAAK8G,UAAUmB,UAAUI,OAAO,UAChCrI,KAAKwI,UAAUP,UAAUC,IAAI,UAE7BlI,KAAKyI,cAAcR,UAAUI,OAAO,UACrC,CAKA,UAAAM,CAAWE,GACWzJ,MAAlBY,KAAK8G,YACP9G,KAAK8G,UAAUmB,UAAUC,IAAI,UAC7BlI,KAAKwI,UAAUP,UAAUC,IAAI,WAG9BW,EAAOZ,UAAUI,OAAO,UAErBQ,GAAU7I,KAAKkH,OAAS2B,GAAU7I,KAAKiH,MACzCjH,KAAKf,MAAMgJ,UAAUI,OAAO,UAE5BrI,KAAKf,MAAMgJ,UAAUC,IAAI,UAG1BW,EAAOlF,iBAAiB,SAASmF,SAAQC,GAAIxD,OAAOyD,YAAW,IAAMD,EAAGE,SAAS,KAEjFjJ,KAAK8G,UAAY+B,EAGjB9L,EAAY,GACb,CAKA,iBAAMiK,GACLhH,KAAKwC,SAAWvF,SAASY,eAAe,YAAY0B,MACpD,IAAI2J,EAAWjM,SAASY,eAAe,YAAY0B,MAGnD,GAAoB,IAAjBS,KAAKwC,UAA8B,IAAZ0G,EAMzB,YADAnM,EAAY,yCAJZiD,KAAKyI,cAAcR,UAAUC,IAAI,UAEjClI,KAAK2C,cAAe,+BAOfhE,KAAKwK,kBAEX,IAAIzL,EAAW,IAAIC,SAASqC,KAAKmF,MAE7B9G,QAAiBC,WAAWC,aAAa,mBAAoBb,GAE9DW,GAEDA,KADEA,GAAyB,GAAZA,IACJ2B,KAAKoJ,WAAW/K,GAKxBA,IACH2B,KAAK8F,QAEL/I,EAAY,8BAGbiD,KAAK8F,OAEP,CAEA,UAAAsD,CAAW1D,GAMV,MALqB,iBAAZ,GAER5G,SAASE,SAGP,aAAc0G,GAEhB5G,SAASC,KAAO2G,EAAO2D,UAEhB,GAGL3D,aAAkB4D,OAEjB5D,EAAO6D,MAAKC,GAAsB,YAAXA,IACtBzD,IAEF/F,KAAK+H,eAAerC,GACK,GAAjBA,EAAOlE,QACfzE,EAAY,gFACZiD,KAAK6F,gBAEL7F,KAAKyJ,gBAAgB/D,GAItB1F,KAAKyJ,gBAAgB/D,IAGf,QAjBR,CAmBD,CAOA,oBAAMqC,CAAe2B,GAEpB1J,KAAK2C,cAAc,8BAEnB,IAGC,UAFmBJ,EAAoBvC,KAAKwC,SAAUxC,KAAKwI,UAAUtL,cAAc,oBAGlF,MAAM,IAAIsC,MAAO,kCAIZQ,KAAK6F,cACZ,CAAC,MAAO3B,GACP,IAAI7F,QAAiBC,WAAWC,aAAa,2BAA4B,IAAI,GAI7E,GAFAR,QAAQC,IAAIK,GAES,GAAlBqL,EAAQlI,OACVzE,EAAY,mEACZiD,KAAK6F,mBACD,CAEJ,IAAI7I,EADJe,QAAQmG,MAAMA,GAGblH,EADsB,8BAApBkH,EAAe,QACP,wEAEA,4DAEXnH,EAAYC,GAGZgD,KAAKyJ,gBAAgBC,EACtB,CACD,CACD,CAMA,kBAAM7D,GACL7F,KAAK2C,cAAc,iBAEnB,IAAIjF,EAAW,IAAIC,SAASqC,KAAKmF,MAKjC,GAJAnF,KAAKmF,KAAKxB,iBAAiB,sBAAsBmF,SAAQC,IAAOA,EAAGY,UAAW,MAC/D3J,KAAKmF,KAAKyE,iBAMxB,OAFA5J,KAAK8F,SAEE,QAGFnH,KAAKwK,kBAEX,IAAI9K,QAAiBC,WAAWC,aAAa,sBAAuBb,GAEpE,OAAIW,GAODkH,OAAOsE,OAAStE,OAAOuE,KAGzB/L,QAAQC,IAAIuH,OAAOwE,OAAO9M,SAASY,eAAe,kBAClDE,QAAQC,IAAIuH,OAAOwE,OAAO9M,UAC1Bc,QAAQC,IAAIuH,OAAOwE,QACnBxE,OAAOwE,OAAO9M,SAASY,eAAe,iBAAiB+K,YAAc,sDAGrErD,OAAOwE,OAAOrH,IAAIsH,UAAY3L,EAAS4L,MAGvC1E,OAAOwE,OAAOrH,IAAIwH,OAAS7L,EAAS6D,GAEpCnE,QAAQC,IAAIuH,OAAOwE,OAAO9M,SAASY,eAAe,kBAGlD0H,OAAOwE,OAAO9M,SAAS0G,iBAAiB,UAAUmF,SAAQC,GAAIA,EAAGV,aAEjErI,KAAK2C,cAAc,yCAEK,IAArBtE,EAASgL,SAEXvK,SAASE,SAGTF,SAASC,KAAOV,EAASgL,WAIpB,IApCNrJ,KAAK8F,SAEE,EAmCT,CAKA,eAAA2D,CAAgBC,GACZA,EAAQS,SAAS,UACnBnK,KAAKoK,mBAIN,IAAI,MAAMC,KAAUX,EAEN,YAAVW,IAIU,SAAVA,EACFrK,KAAK2I,WAAW3I,KAAKiH,OAErBjH,KAAK2I,WAAW3I,KAAKkH,OAGxB,CAKA,sBAAMkD,GAELpK,KAAK2I,WAAW3I,KAAKiH,OAGrBlK,EAAY,qBADI4B,KAAKC,WAAW,MAAM,EAAO,GAAI,IAAI,MAGrD,IAAIlB,EAAW,IAAIC,SACnBD,EAASO,OAAO,WAAY+B,KAAKwC,UAKhCzF,QAHoBuB,WAAWC,aAAa,2BAA4Bb,GAAU,IAKtE,wBAEd,CAGA,mBAAMoK,CAAcV,GACnB,IAAIjC,EAAUiC,EAAOG,QAAQ,QAEzB+C,EAAWnF,EAAKjI,cAAc,kBAE9BqN,EAAgBpF,EAAKjI,cAAc,qBAGvC,GAAoB,MAAjBqN,GAAoD,IAA3BA,EAAcpN,WAAmBoN,EAActC,UAAUuC,SAAS,UAmB7F,OAjBAvN,SAASY,eAAe,aAAaoK,UAAUC,IAAI,UAEL,MAA3C/C,EAAKjI,cAAc,uBACrBqN,EAAcpN,UAAY,8IAEsD6C,KAAKwC,4CACvE+H,EAAcpN,WAI7BoN,EAActC,UAAUI,OAAO,UAE/BiC,EAAOpM,QAAQuM,QAAUH,EAAOnN,UAChCmN,EAAOnN,UAAY,8BAEnBmN,EAAOrC,UAAUC,IAAI,UAKtB,GAAoB,IAAjBlI,KAAKwC,SAEP,YADA7D,KAAK+L,eAAe,8BAA+B,SAIpDJ,EAAOrC,UAAUC,IAAI,UACrB,IAAIyC,EAAShM,KAAKC,WAAW0L,GAAQ,EAAO,GAAI,mCAE5C5M,EAAW,IAAIC,SAASwH,GAC5BzH,EAASO,OAAO,WAAY+B,KAAKwC,UAEjC,IAAInE,QAAiBC,WAAWC,aAAa,0BAA2Bb,GAEpEW,IACHM,KAAK+L,eAAerM,EAAU,WAG9BpB,SAASY,eAAe,aAAaoK,UAAUI,OAAO,UAEtDkC,EAActC,UAAUC,IAAI,UAE5BoC,EAAOnN,UAAYmN,EAAOpM,QAAQuM,QAClCH,EAAOrC,UAAUI,OAAO,WAGzBsC,EAAOtC,SACPiC,EAAOrC,UAAUI,OAAO,SAEzB,CAGA,oBAAML,CAAeZ,GACpB,IAAIjC,EAASiC,EAAOG,QAAQ,QAG5BpC,EAAKjI,cAAc,mBAAmB+K,UAAUI,OAAO,UAEvD,IAAI3K,EAAW,IAAIC,SAASwH,GAExB9G,QAAiBC,WAAWC,aAAa,6BAA8Bb,GAExEW,GACFM,KAAK+L,eAAerM,GAIrB8G,EAAKW,QAGLX,EAAKjI,cAAc,mBAAmB+K,UAAUC,IAAI,SACrD,CAGA,cAAAZ,Gd9dArK,SAAS0G,iBAAiB,kDAAkDmF,SAAQC,GAAIA,EAAGd,UAAUI,OAAO,aAC5GpL,SAASC,cAAc,QAAQ+K,UAAUI,OAAO,oBAChDpL,SAAS0G,iBAAiB,yCAAyCmF,SAAQC,GAAIA,EAAG6B,aAAe,IciehG3N,SAASC,cAAc,QAAQ2N,MAAMC,UAAY,SAEjD9K,KAAK+K,MAAQ9N,SAASY,eAAe,eACrCmC,KAAK+K,MAAMF,MAAMG,QAAU,QAE3BhL,KAAK+K,MAAM9C,UAAUI,OAAO,UAE5BrI,KAAK0I,WACN,CAGA,6BAAAlC,GACC,IAAIuC,EAAK9L,SAASC,cAAc,uBAEhC,GAAW,OAAP6L,EAAa,CAChB,IAAIkC,EAAUlC,EAAGmC,aAAa,WAC1BC,EAAO,2BAGVF,EADGE,EAAG7G,KAAK2G,GACDA,EAAQ7J,QAAQ+J,EAAI,qBAEpB,CAACF,EAAS,qBAAqBG,KAAK,MAG/CrC,EAAGsC,aAAa,UAAWJ,EAC5B,CACD,GAIDhO,SAASyJ,iBAAiB,oBAAoB,KAE7CX,IAEA9I,SAAS0G,iBAAiB,iBAAiBmF,SAAQC,IAClDA,EAAGd,UAAUI,OAAO,SAAS,IAG9B3F,IAAIzD,MAAQ,IAAI,CAAO,G","sources":["webpack://login/./partials/shared.js","webpack://login/./partials/qr_login.js","webpack://login/./node_modules/@simplewebauthn/browser/esm/helpers/browserSupportsWebAuthn.js","webpack://login/./node_modules/@simplewebauthn/browser/esm/helpers/webAuthnError.js","webpack://login/./node_modules/@simplewebauthn/browser/esm/helpers/webAuthnAbortService.js","webpack://login/./node_modules/@simplewebauthn/browser/esm/helpers/bufferToBase64URLString.js","webpack://login/./node_modules/@simplewebauthn/browser/esm/helpers/base64URLStringToBuffer.js","webpack://login/./node_modules/@simplewebauthn/browser/esm/helpers/browserSupportsWebAuthnAutofill.js","webpack://login/./node_modules/@simplewebauthn/browser/esm/helpers/toPublicKeyCredentialDescriptor.js","webpack://login/./node_modules/@simplewebauthn/browser/esm/helpers/toAuthenticatorAttachment.js","webpack://login/./partials/webauth.js","webpack://login/./node_modules/@simplewebauthn/browser/esm/methods/startAuthentication.js","webpack://login/./node_modules/@simplewebauthn/browser/esm/helpers/identifyAuthenticationError.js","webpack://login/./node_modules/@simplewebauthn/browser/esm/helpers/isValidDomain.js","webpack://login/./login.js"],"sourcesContent":["export function closeMobileMenu(){\r\n\t//close mobile menu\r\n\tdocument.querySelectorAll('#site-navigation, #mobile-menu-control-wrapper').forEach(el=>el.classList.remove('toggled'));\r\n\tdocument.querySelector('body').classList.remove('mobile-menu-open');\r\n\tdocument.querySelectorAll(\"#mobile-menu-control-wrapper > button\").forEach(el=>el.ariaExpanded = 0);\r\n}\r\n\r\n// Decodes a Base64Url string\r\nconst base64UrlDecode = (input) => {\r\ninput = input\r\n\t.replace(/-/g, '+')\r\n\t.replace(/_/g, '/');\r\n\r\nconst pad = input.length % 4;\r\nif (pad) {\r\n\tif (pad === 1) {\r\n\tthrow new Error('InvalidLengthError: Input base64url string is the wrong length to determine padding');\r\n\t}\r\n\tinput += new Array(5-pad).join('=');\r\n}\r\n\r\nreturn window.atob(input);\r\n};\r\n\r\n// Converts an array of bytes into a Base64Url string\r\nconst arrayToBase64String = (a) => btoa(String.fromCharCode(...a));\r\n\r\n// Prepares the public key options object returned by the Webauthn Framework\r\nexport const preparePublicKeyOptions = publicKey => {\r\n\t//Convert challenge from Base64Url string to Uint8Array\r\n\tpublicKey.challenge = Uint8Array.from(\r\n\t\tbase64UrlDecode(publicKey.challenge),\r\n\t\tc => c.charCodeAt(0)\r\n\t);\r\n\r\n\t//Convert the user ID from Base64 string to Uint8Array\r\n\tif (publicKey.user !== undefined) {\r\n\t\tpublicKey.user = {\r\n\t\t...publicKey.user,\r\n\t\tid: Uint8Array.from(\r\n\t\t\twindow.atob(publicKey.user.id),\r\n\t\t\tc => c.charCodeAt(0)\r\n\t\t),\r\n\t\t};\r\n\t}\r\n\r\n\t//If excludeCredentials is defined, we convert all IDs to Uint8Array\r\n\tif (publicKey.excludeCredentials !== undefined) {\r\n\t\tpublicKey.excludeCredentials = publicKey.excludeCredentials.map(\r\n\t\t\tdata => {\r\n\t\t\treturn {\r\n\t\t\t\t...data,\r\n\t\t\t\tid: Uint8Array.from(\r\n\t\t\t\t\tbase64UrlDecode(data.id),\r\n\t\t\t\t\tc => c.charCodeAt(0)\r\n\t\t\t\t),\r\n\t\t\t};\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n\r\n\tif (publicKey.allowCredentials !== undefined) {\r\n\t\tpublicKey.allowCredentials = publicKey.allowCredentials.map(\r\n\t\t\tdata => {\r\n\t\t\treturn {\r\n\t\t\t\t...data,\r\n\t\t\t\tid: Uint8Array.from(\r\n\t\t\t\t\tbase64UrlDecode(data.id),\r\n\t\t\t\t\tc => c.charCodeAt(0)\r\n\t\t\t\t),\r\n\t\t\t};\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n\r\n\treturn publicKey;\r\n};\r\n\r\n// Prepares the public key credentials object returned by the authenticator\r\nexport const preparePublicKeyCredentials = data => {\r\n\tconst publicKeyCredential = {\r\n\t\tid: data.id,\r\n\t\ttype: data.type,\r\n\t\trawId: arrayToBase64String(new Uint8Array(data.rawId)),\r\n\t\tresponse: {\r\n\t\tclientDataJSON: arrayToBase64String(\r\n\t\t\tnew Uint8Array(data.response.clientDataJSON)\r\n\t\t),\r\n\t\t},\r\n\t};\r\n\r\n\tif (data.response.attestationObject !== undefined) {\r\n\t\tpublicKeyCredential.response.attestationObject = arrayToBase64String(\r\n\t\t\tnew Uint8Array(data.response.attestationObject)\r\n\t\t);\r\n\t}\r\n\r\n\tif (data.response.authenticatorData !== undefined) {\r\n\t\tpublicKeyCredential.response.authenticatorData = arrayToBase64String(\r\n\t\t\tnew Uint8Array(data.response.authenticatorData)\r\n\t\t);\r\n\t}\r\n\r\n\tif (data.response.signature !== undefined) {\r\n\t\tpublicKeyCredential.response.signature = arrayToBase64String(\r\n\t\t\tnew Uint8Array(data.response.signature)\r\n\t\t);\r\n\t}\r\n\r\n\tif (data.response.userHandle !== undefined) {\r\n\t\tpublicKeyCredential.response.userHandle = arrayToBase64String(\r\n\t\t\tnew Uint8Array(data.response.userHandle)\r\n\t\t);\r\n\t}\r\n\r\n\treturn publicKeyCredential;\r\n};\r\n\r\nexport function showMessage(message){\r\n\tlet el = document.querySelector(\"#message\");\r\n\tel.innerHTML= DOMPurify.sanitize(message);\r\n}\r\n\r\nexport function togglePassworView(ev){\r\n\tev.stopImmediatePropagation();\r\n\t\r\n\tvar target\t= ev.target;\r\n\r\n\tif(ev.target.tagName == 'IMG'){\r\n\t\ttarget\t= ev.target.parentNode;\r\n\t}\r\n\r\n\tif(target.dataset.toggle == '0'){\r\n\t\ttarget.title\t\t\t\t\t\t\t\t= 'Hide password';\r\n\t\ttarget.dataset.toggle\t\t\t\t\t\t= '1';\r\n\t\ttarget.innerHTML\t\t\t\t\t\t\t= target.innerHTML.replace('invisible', 'visible');\r\n\t\ttarget.closest('.password').querySelector('input[type=\"password\"]').type\t= 'text';\r\n\t}else{\r\n\t\ttarget.title\t\t\t\t\t\t\t\t= 'Show password';\r\n\t\ttarget.dataset.toggle\t\t\t\t\t\t= '0';\r\n\t\ttarget.innerHTML\t\t\t\t\t\t\t= target.innerHTML.replace('visible', 'invisible');\r\n\t\ttarget.closest('.password').querySelector('input[type=\"text\"]').type\t= 'password';\r\n\t}\r\n}","import {\r\n\tshowMessage\r\n} from './shared.js';\r\n\r\nlet intervalId;\r\nlet checkCount\t\t\t= 5;\r\n\r\n// Show qr code and start polling for login info\r\nexport function showLoginQrCode(){\r\n\tdocument.getElementById('usercred-wrapper').classList.add('hidden');\r\n\r\n\tshowMessage('Fetching QR code...');\r\n\r\n\tMain.showLoader(document.getElementById(`qrcode-wrapper`).firstChild);\r\n\r\n\t// get the QR code\r\n\trefreshQrCode();\r\n\t\r\n\t // Check for login permission every 5 seconds\r\n\tintervalId\t= setInterval(refreshQrCode, 5000);\r\n}\r\n\r\nfunction login(response){\r\n\tclearInterval(intervalId);\r\n\r\n\tshowMessage('Succesfully logged in, redirecting...');\r\n\r\n\tMain.showLoader(document.getElementById(`qrcode-wrapper`));\r\n\r\n\tif(!response.startsWith('http')){\r\n\t\tlocation.reload();\r\n\t}else{\r\n\t\tlocation.href = response;\r\n\t}\r\n}\r\n\r\nasync function refreshQrCode(){\r\n\tcheckCount++;\r\n\r\n    let formData    = new FormData();\r\n\tlet wrapper\t\t= document.getElementById(`qrcode-wrapper`);\r\n\tlet qrCodeImage = document.getElementById('login-qr-code');\r\n\r\n\t// refresh the qr code after 30 seconds\r\n\tif(checkCount == 6){\r\n\t\tconsole.log('Refreshing QR code');\r\n\r\n        checkCount      = 0;\r\n\r\n\t\t// also check if previous qr code has been scanned\r\n\t\tif(qrCodeImage != null){\r\n\t\t\tformData.append('token', qrCodeImage.dataset.token);\r\n\t\t\tformData.append('key', qrCodeImage.dataset.key);\r\n\t\t}\r\n\t\t\r\n\t\t// Use AJAX to get the qr code\r\n\t\tlet response    = await FormSubmit.fetchRestApi('login/get_login_qr_code', formData);\r\n\r\n\t\tif(response){\r\n\t\t\twrapper.innerHTML=response;\r\n\r\n\t\t\tshowMessage('Scan the QR code to login');\r\n\r\n\t\t\tconsole.log(`New token: ${document.getElementById('login-qr-code').dataset.token}`);\r\n\t\t\tconsole.log(`New key: ${document.getElementById('login-qr-code').dataset.key}`);\r\n\t\t}else{\r\n\t\t\twrapperinnerHTML='';\r\n\r\n\t\t\tshowMessage('QR Code Refresh Failed');\r\n\t\t}\r\n\t}else{\r\n\t\tconsole.log('Checking for login permission');\r\n\t\t\r\n        if(qrCodeImage == null){\r\n            return;\r\n        }\r\n\r\n\t\t// Use AJAX to check if the code has been scanned\r\n        formData.append('token', qrCodeImage.dataset.token);\r\n        formData.append('key', qrCodeImage.dataset.key);\r\n        formData.append('old-token', qrCodeImage.dataset.oldtoken);\r\n\t\tlet response\t= await FormSubmit.fetchRestApi('login/qr_code_scanned', formData);\r\n\r\n\t\tif(response){\r\n\t\t\tlogin(response);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport function hideQrCode(){\r\n\tclearInterval(intervalId);\r\n\r\n\tshowMessage('');\r\n\r\n\tdocument.getElementById('usercred-wrapper').classList.remove('hidden');\r\n\r\n\tdocument.getElementById(`qrcode-wrapper`).innerHTML = '';\r\n}","/**\n * Determine if the browser is capable of Webauthn\n */\nexport function browserSupportsWebAuthn() {\n    return _browserSupportsWebAuthnInternals.stubThis(globalThis?.PublicKeyCredential !== undefined &&\n        typeof globalThis.PublicKeyCredential === 'function');\n}\n/**\n * Make it possible to stub the return value during testing\n * @ignore Don't include this in docs output\n */\nexport const _browserSupportsWebAuthnInternals = {\n    stubThis: (value) => value,\n};\n","/**\n * A custom Error used to return a more nuanced error detailing _why_ one of the eight documented\n * errors in the spec was raised after calling `navigator.credentials.create()` or\n * `navigator.credentials.get()`:\n *\n * - `AbortError`\n * - `ConstraintError`\n * - `InvalidStateError`\n * - `NotAllowedError`\n * - `NotSupportedError`\n * - `SecurityError`\n * - `TypeError`\n * - `UnknownError`\n *\n * Error messages were determined through investigation of the spec to determine under which\n * scenarios a given error would be raised.\n */\nexport class WebAuthnError extends Error {\n    constructor({ message, code, cause, name, }) {\n        // @ts-ignore: help Rollup understand that `cause` is okay to set\n        super(message, { cause });\n        Object.defineProperty(this, \"code\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        this.name = name ?? cause.name;\n        this.code = code;\n    }\n}\n","class BaseWebAuthnAbortService {\n    constructor() {\n        Object.defineProperty(this, \"controller\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n    }\n    createNewAbortSignal() {\n        // Abort any existing calls to navigator.credentials.create() or navigator.credentials.get()\n        if (this.controller) {\n            const abortError = new Error('Cancelling existing WebAuthn API call for new one');\n            abortError.name = 'AbortError';\n            this.controller.abort(abortError);\n        }\n        const newController = new AbortController();\n        this.controller = newController;\n        return newController.signal;\n    }\n    cancelCeremony() {\n        if (this.controller) {\n            const abortError = new Error('Manually cancelling existing WebAuthn API call');\n            abortError.name = 'AbortError';\n            this.controller.abort(abortError);\n            this.controller = undefined;\n        }\n    }\n}\n/**\n * A service singleton to help ensure that only a single WebAuthn ceremony is active at a time.\n *\n * Users of **@simplewebauthn/browser** shouldn't typically need to use this, but it can help e.g.\n * developers building projects that use client-side routing to better control the behavior of\n * their UX in response to router navigation events.\n */\nexport const WebAuthnAbortService = new BaseWebAuthnAbortService();\n","/**\n * Convert the given array buffer into a Base64URL-encoded string. Ideal for converting various\n * credential response ArrayBuffers to string for sending back to the server as JSON.\n *\n * Helper method to compliment `base64URLStringToBuffer`\n */\nexport function bufferToBase64URLString(buffer) {\n    const bytes = new Uint8Array(buffer);\n    let str = '';\n    for (const charCode of bytes) {\n        str += String.fromCharCode(charCode);\n    }\n    const base64String = btoa(str);\n    return base64String.replace(/\\+/g, '-').replace(/\\//g, '_').replace(/=/g, '');\n}\n","/**\n * Convert from a Base64URL-encoded string to an Array Buffer. Best used when converting a\n * credential ID from a JSON string to an ArrayBuffer, like in allowCredentials or\n * excludeCredentials\n *\n * Helper method to compliment `bufferToBase64URLString`\n */\nexport function base64URLStringToBuffer(base64URLString) {\n    // Convert from Base64URL to Base64\n    const base64 = base64URLString.replace(/-/g, '+').replace(/_/g, '/');\n    /**\n     * Pad with '=' until it's a multiple of four\n     * (4 - (85 % 4 = 1) = 3) % 4 = 3 padding\n     * (4 - (86 % 4 = 2) = 2) % 4 = 2 padding\n     * (4 - (87 % 4 = 3) = 1) % 4 = 1 padding\n     * (4 - (88 % 4 = 0) = 4) % 4 = 0 padding\n     */\n    const padLength = (4 - (base64.length % 4)) % 4;\n    const padded = base64.padEnd(base64.length + padLength, '=');\n    // Convert to a binary string\n    const binary = atob(padded);\n    // Convert binary string to buffer\n    const buffer = new ArrayBuffer(binary.length);\n    const bytes = new Uint8Array(buffer);\n    for (let i = 0; i < binary.length; i++) {\n        bytes[i] = binary.charCodeAt(i);\n    }\n    return buffer;\n}\n","import { browserSupportsWebAuthn } from './browserSupportsWebAuthn.js';\n/**\n * Determine if the browser supports conditional UI, so that WebAuthn credentials can\n * be shown to the user in the browser's typical password autofill popup.\n */\nexport function browserSupportsWebAuthnAutofill() {\n    if (!browserSupportsWebAuthn()) {\n        return _browserSupportsWebAuthnAutofillInternals.stubThis(new Promise((resolve) => resolve(false)));\n    }\n    /**\n     * I don't like the `as unknown` here but there's a `declare var PublicKeyCredential` in\n     * TS' DOM lib that's making it difficult for me to just go `as PublicKeyCredentialFuture` as I\n     * want. I think I'm fine with this for now since it's _supposed_ to be temporary, until TS types\n     * have a chance to catch up.\n     */\n    const globalPublicKeyCredential = globalThis\n        .PublicKeyCredential;\n    if (globalPublicKeyCredential?.isConditionalMediationAvailable === undefined) {\n        return _browserSupportsWebAuthnAutofillInternals.stubThis(new Promise((resolve) => resolve(false)));\n    }\n    return _browserSupportsWebAuthnAutofillInternals.stubThis(globalPublicKeyCredential.isConditionalMediationAvailable());\n}\n// Make it possible to stub the return value during testing\nexport const _browserSupportsWebAuthnAutofillInternals = {\n    stubThis: (value) => value,\n};\n","import { base64URLStringToBuffer } from './base64URLStringToBuffer.js';\nexport function toPublicKeyCredentialDescriptor(descriptor) {\n    const { id } = descriptor;\n    return {\n        ...descriptor,\n        id: base64URLStringToBuffer(id),\n        /**\n         * `descriptor.transports` is an array of our `AuthenticatorTransportFuture` that includes newer\n         * transports that TypeScript's DOM lib is ignorant of. Convince TS that our list of transports\n         * are fine to pass to WebAuthn since browsers will recognize the new value.\n         */\n        transports: descriptor.transports,\n    };\n}\n","const attachments = ['cross-platform', 'platform'];\n/**\n * If possible coerce a `string` value into a known `AuthenticatorAttachment`\n */\nexport function toAuthenticatorAttachment(attachment) {\n    if (!attachment) {\n        return;\n    }\n    if (attachments.indexOf(attachment) < 0) {\n        return;\n    }\n    return attachment;\n}\n","import {\r\n    preparePublicKeyCredentials,\r\n    preparePublicKeyOptions,\r\n\tshowMessage\r\n} from './shared.js';\r\n\r\nimport { startAuthentication } from '@simplewebauthn/browser';\r\n\r\nlet credParsing\t\t\t        = false;\r\nlet abortController;\r\n\r\nwindow.PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable().then(\r\n\tresult => {\r\n\t  if (!result) {\r\n\t\tconsole.log(\"No platform authenticator found. If your OS does not come with one, try using devtools to set one up.\");\r\n\t  }\r\n\t}\r\n);\r\n\r\n/**\r\n * Do a webauthn verification after loggin with username and password\r\n * \r\n * @param {string} username The user name to authenticate\r\n * @param {*} messageEl the html onject to display messages in\r\n */\r\nexport async function webAuthVerification(username){\r\n\ttry {\r\n\t\t// 1. Fetch authentication options from server\r\n\t\tlet formData\t\t\t\t= new FormData();\r\n\t\tformData.append('username', username);\r\n\r\n\t\tconst optionsJSON\t\t\t\t\t= await FormSubmit.fetchRestApi('login/auth_start', formData);\r\n\t\tif(!optionsJSON){\r\n\t\t\tthrow new Error('Fetching Server Challenge failed');\r\n\t\t}\r\n\r\n\t\t// Update message\r\n\t\tsim.login.loadingScreen('Verifying credentials...');\r\n\r\n\t\t// 2. Start authentication (handles encoding automatically)\r\n\t\tconst assertionResponse \t= await startAuthentication({ ...optionsJSON, useBrowserAutofill: true });\r\n\r\n\t\t// 3. Send to server for validation\r\n\t\tlet form \t\t\t\t\t= document.getElementById('loginform') ? document.getElementById('loginform') : undefined;\r\n\t\tformData\t\t\t\t\t= new FormData(form);\r\n\t\tformData.append('publicKeyCredential', btoa(JSON.stringify(assertionResponse)));\r\n\t\tlet response\t\t\t\t\t= await FormSubmit.fetchRestApi('login/auth_finish', formData);\r\n\t\tif(!response || response.verified){\r\n\t\t\tthrow new Error('Verification failed');\r\n\t\t}\r\n\r\n\t\tshowMessage('Verification successfull');\r\n\r\n\t\treturn true;\r\n\t} catch (error) {\r\n\t\tconsole.error('Authentication failed:', error);\r\n\r\n\t\tshowMessage(error);\r\n\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\n/**\r\n * Start passkey login without username\r\n * \r\n * @param {string} mediation the type of request\r\n * \r\n * @returns \r\n */\r\nexport let startConditionalRequest = async (mediation) => {\r\n\tif (window.PublicKeyCredential && PublicKeyCredential.isConditionalMediationAvailable) {\r\n\t\tconsole.log(\"Conditional UI is understood by the browser\");\r\n\t\tif (!await window.PublicKeyCredential.isConditionalMediationAvailable()) {\r\n\t\t\tconsole.log(\"Conditional UI is understood by your browser but not available\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t} else {\r\n\t\tif (!navigator.credentials.conditionalMediationSupported) {\r\n\t\t\tconsole.log(\"Your browser does not implement Conditional UI (are you running the right chrome/safari version with the right flags?)\");\r\n\t\t\treturn;\r\n\t\t} else {\r\n\t\t\tconsole.log(\"This browser understand the old version of Conditional UI feature detection\");\r\n\t\t}\r\n\t}\r\n\r\n\tsim.login.loadingScreen('Performing passkey login');\r\n\r\n\tlet webauthResult =  await webAuthVerification('');\r\n\r\n\tif(webauthResult){\r\n\t\tshowMessage('Passkey login succesfull');\r\n\r\n\t\treturn await sim.login.requestLogin();\r\n\t}else{\r\n\t\tsim.login.reset();\r\n\r\n\t\tshowMessage('Passkey login failed, try using your username and password');\r\n\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\nexport async function checkWebauthnAvailable(){\r\n\tlet webauthnSupported\t= false;\r\n\t\r\n\tif (window.PublicKeyCredential) {\r\n\t\tlet available\t= await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable();\r\n\t\tif (available) {\r\n\t\t\twebauthnSupported = true;\r\n\t\t} else {\r\n\t\t\tconsole.log(\"WebAuthn supported, Platform Authenticator not supported.\");\r\n\t\t}\r\n\t} else {\r\n\t\tconsole.log(\"Not supported.\");\r\n\t}\r\n\r\n\treturn webauthnSupported;\r\n}","import { bufferToBase64URLString } from '../helpers/bufferToBase64URLString.js';\nimport { base64URLStringToBuffer } from '../helpers/base64URLStringToBuffer.js';\nimport { browserSupportsWebAuthn } from '../helpers/browserSupportsWebAuthn.js';\nimport { browserSupportsWebAuthnAutofill } from '../helpers/browserSupportsWebAuthnAutofill.js';\nimport { toPublicKeyCredentialDescriptor } from '../helpers/toPublicKeyCredentialDescriptor.js';\nimport { identifyAuthenticationError } from '../helpers/identifyAuthenticationError.js';\nimport { WebAuthnAbortService } from '../helpers/webAuthnAbortService.js';\nimport { toAuthenticatorAttachment } from '../helpers/toAuthenticatorAttachment.js';\n/**\n * Begin authenticator \"login\" via WebAuthn assertion\n *\n * @param optionsJSON Output from **@simplewebauthn/server**'s `generateAuthenticationOptions()`\n * @param useBrowserAutofill (Optional) Initialize conditional UI to enable logging in via browser autofill prompts. Defaults to `false`.\n * @param verifyBrowserAutofillInput (Optional) Ensure a suitable `<input>` element is present when `useBrowserAutofill` is `true`. Defaults to `true`.\n */\nexport async function startAuthentication(options) {\n    // @ts-ignore: Intentionally check for old call structure to warn about improper API call\n    if (!options.optionsJSON && options.challenge) {\n        console.warn('startAuthentication() was not called correctly. It will try to continue with the provided options, but this call should be refactored to use the expected call structure instead. See https://simplewebauthn.dev/docs/packages/browser#typeerror-cannot-read-properties-of-undefined-reading-challenge for more information.');\n        // @ts-ignore: Reassign the options, passed in as a positional argument, to the expected variable\n        options = { optionsJSON: options };\n    }\n    const { optionsJSON, useBrowserAutofill = false, verifyBrowserAutofillInput = true, } = options;\n    if (!browserSupportsWebAuthn()) {\n        throw new Error('WebAuthn is not supported in this browser');\n    }\n    // We need to avoid passing empty array to avoid blocking retrieval\n    // of public key\n    let allowCredentials;\n    if (optionsJSON.allowCredentials?.length !== 0) {\n        allowCredentials = optionsJSON.allowCredentials?.map(toPublicKeyCredentialDescriptor);\n    }\n    // We need to convert some values to Uint8Arrays before passing the credentials to the navigator\n    const publicKey = {\n        ...optionsJSON,\n        challenge: base64URLStringToBuffer(optionsJSON.challenge),\n        allowCredentials,\n    };\n    // Prepare options for `.get()`\n    const getOptions = {};\n    /**\n     * Set up the page to prompt the user to select a credential for authentication via the browser's\n     * input autofill mechanism.\n     */\n    if (useBrowserAutofill) {\n        if (!(await browserSupportsWebAuthnAutofill())) {\n            throw Error('Browser does not support WebAuthn autofill');\n        }\n        // Check for an <input> with \"webauthn\" in its `autocomplete` attribute\n        const eligibleInputs = document.querySelectorAll(\"input[autocomplete$='webauthn']\");\n        // WebAuthn autofill requires at least one valid input\n        if (eligibleInputs.length < 1 && verifyBrowserAutofillInput) {\n            throw Error('No <input> with \"webauthn\" as the only or last value in its `autocomplete` attribute was detected');\n        }\n        // `CredentialMediationRequirement` doesn't know about \"conditional\" yet as of\n        // typescript@4.6.3\n        getOptions.mediation = 'conditional';\n        // Conditional UI requires an empty allow list\n        publicKey.allowCredentials = [];\n    }\n    // Finalize options\n    getOptions.publicKey = publicKey;\n    // Set up the ability to cancel this request if the user attempts another\n    getOptions.signal = WebAuthnAbortService.createNewAbortSignal();\n    // Wait for the user to complete assertion\n    let credential;\n    try {\n        credential = (await navigator.credentials.get(getOptions));\n    }\n    catch (err) {\n        throw identifyAuthenticationError({ error: err, options: getOptions });\n    }\n    if (!credential) {\n        throw new Error('Authentication was not completed');\n    }\n    const { id, rawId, response, type } = credential;\n    let userHandle = undefined;\n    if (response.userHandle) {\n        userHandle = bufferToBase64URLString(response.userHandle);\n    }\n    // Convert values to base64 to make it easier to send back to the server\n    return {\n        id,\n        rawId: bufferToBase64URLString(rawId),\n        response: {\n            authenticatorData: bufferToBase64URLString(response.authenticatorData),\n            clientDataJSON: bufferToBase64URLString(response.clientDataJSON),\n            signature: bufferToBase64URLString(response.signature),\n            userHandle,\n        },\n        type,\n        clientExtensionResults: credential.getClientExtensionResults(),\n        authenticatorAttachment: toAuthenticatorAttachment(credential.authenticatorAttachment),\n    };\n}\n","import { isValidDomain } from './isValidDomain.js';\nimport { WebAuthnError } from './webAuthnError.js';\n/**\n * Attempt to intuit _why_ an error was raised after calling `navigator.credentials.get()`\n */\nexport function identifyAuthenticationError({ error, options, }) {\n    const { publicKey } = options;\n    if (!publicKey) {\n        throw Error('options was missing required publicKey property');\n    }\n    if (error.name === 'AbortError') {\n        if (options.signal instanceof AbortSignal) {\n            // https://www.w3.org/TR/webauthn-2/#sctn-createCredential (Step 16)\n            return new WebAuthnError({\n                message: 'Authentication ceremony was sent an abort signal',\n                code: 'ERROR_CEREMONY_ABORTED',\n                cause: error,\n            });\n        }\n    }\n    else if (error.name === 'NotAllowedError') {\n        /**\n         * Pass the error directly through. Platforms are overloading this error beyond what the spec\n         * defines and we don't want to overwrite potentially useful error messages.\n         */\n        return new WebAuthnError({\n            message: error.message,\n            code: 'ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY',\n            cause: error,\n        });\n    }\n    else if (error.name === 'SecurityError') {\n        const effectiveDomain = globalThis.location.hostname;\n        if (!isValidDomain(effectiveDomain)) {\n            // https://www.w3.org/TR/webauthn-2/#sctn-discover-from-external-source (Step 5)\n            return new WebAuthnError({\n                message: `${globalThis.location.hostname} is an invalid domain`,\n                code: 'ERROR_INVALID_DOMAIN',\n                cause: error,\n            });\n        }\n        else if (publicKey.rpId !== effectiveDomain) {\n            // https://www.w3.org/TR/webauthn-2/#sctn-discover-from-external-source (Step 6)\n            return new WebAuthnError({\n                message: `The RP ID \"${publicKey.rpId}\" is invalid for this domain`,\n                code: 'ERROR_INVALID_RP_ID',\n                cause: error,\n            });\n        }\n    }\n    else if (error.name === 'UnknownError') {\n        // https://www.w3.org/TR/webauthn-2/#sctn-op-get-assertion (Step 1)\n        // https://www.w3.org/TR/webauthn-2/#sctn-op-get-assertion (Step 12)\n        return new WebAuthnError({\n            message: 'The authenticator was unable to process the specified options, or could not create a new assertion signature',\n            code: 'ERROR_AUTHENTICATOR_GENERAL_ERROR',\n            cause: error,\n        });\n    }\n    return error;\n}\n","/**\n * A simple test to determine if a hostname is a properly-formatted domain name\n *\n * A \"valid domain\" is defined here: https://url.spec.whatwg.org/#valid-domain\n *\n * Regex sourced from here:\n * https://www.oreilly.com/library/view/regular-expressions-cookbook/9781449327453/ch08s15.html\n */\nexport function isValidDomain(hostname) {\n    return (\n    // Consider localhost valid as well since it's okay wrt Secure Contexts\n    hostname === 'localhost' ||\n        /^([a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}$/i.test(hostname));\n}\n","import {\r\n\tcloseMobileMenu,\r\n\tshowMessage,\r\n\ttogglePassworView\r\n} from './partials/shared.js';\r\n\r\nimport {\r\n\tshowLoginQrCode,\r\n\thideQrCode\r\n} from './partials/qr_login.js';\r\n\r\nimport {\r\n\tstartConditionalRequest,\r\n\tcheckWebauthnAvailable,\r\n\twebAuthVerification\r\n} from './partials/webauth.js';\r\n\r\n//Add an event listener to the login or register button\r\nconsole.log(\"Login.js loaded\");\r\n\r\nconst login = class{\r\n\tconstructor() {\r\n\t\tthis.init();\r\n\r\n\t\tlet params = new Proxy(new URLSearchParams(window.location.search), {\r\n\t\t\tget: (searchParams, prop) => searchParams.get(prop),\r\n\t\t});\r\n\r\n\t\tif(params['showlogin'] != null){\r\n\t\t\tconsole.log('Trying silent login');\r\n\t\t\tstartConditionalRequest('silent');\r\n\t\t}\r\n\r\n\t\tif(this.checkIsIOS){\r\n\t\t\tthis.addMaximumScaleToMetaViewport();\r\n\t\t}\r\n\r\n\t\tthis.eventListeners();\r\n\t};\r\n\r\n\teventListeners(){\r\n\t\tdocument.addEventListener('keypress', (e) => {\r\n\t\t\tif (e.key === 'Enter' && this.creds != null){\r\n\t\t\t\te.stopImmediatePropagation();\r\n\r\n\t\t\t\tif(this.curScreen == this.creds && document.getElementById('check-cred').disabled == false){\r\n\t\t\t\t\tthis.verifyCreds();\r\n\t\t\t\t}else if(this.curScreen == this.email || this.curScreen == this.twofa){\r\n\t\t\t\t\tthis.requestLogin();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tdocument.addEventListener(\"click\", async (event) => {\r\n\t\t\tlet target = event.target;\r\n\r\n\t\t\tif(target.matches('.login')){\r\n\t\t\t\tthis.openLoginModal();\r\n\r\n\t\t\t\tconsole.log('Trying silent login');\r\n\t\t\t}else if(target.id == 'check-cred'){\r\n\t\t\t\t// Check if a valid username and password is submitted\r\n\t\t\t\tthis.verifyCreds();\r\n\t\t\t}else if(target.id == \"login-button\"){\r\n\t\t\t\t// Submit the login form when averything is ok\r\n\t\t\t\tthis.requestLogin();\r\n\t\t\t}else if(target.closest('.toggle-pwd-view') != null){\r\n\t\t\t\ttogglePassworView(event);\r\n\t\t\t}else if(target.id == 'password-reset-form' || target.id == \"lost-pwd-link\"){\r\n\t\t\t\tthis.resetPassword(target);\r\n\t\t\t}else if(target.id == 'retry_webauthn'){\r\n\t\t\t\tthis.showMessage('');\r\n\t\t\t\tthis.verifyWebauthn([]);\r\n\t\t\t}else if(target.name == 'request_account'){\r\n\t\t\t\tthis.requestAccount(target);\r\n\t\t\t}else if(target.closest(`[name='fingerprintpicture']`) != null){\r\n\t\t\t\tstartConditionalRequest('silent');\r\n\t\t\t}else if(target.matches('.show-login-qr')){\r\n\t\t\t\tshowLoginQrCode();\r\n\t\t\t}else if(target.matches('.close-qr')){\r\n\t\t\t\thideQrCode();\r\n\t\t\t}else{\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t});\r\n\t};\r\n\r\n\tcheckIsIOS(){\r\n\t\treturn /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;\r\n\t};\r\n\r\n\tinit(){\r\n\t\tthis.form\t\t\t= document.getElementById('loginform');\r\n\t\tthis.msgScreen\t\t= document.getElementById('message-wrapper');\r\n\t\tthis.creds\t\t\t= document.getElementById('credentials-wrapper');\r\n\t\tthis.twofa\t\t\t= document.getElementById('authenticator-wrapper');\r\n\t\tthis.email\t\t\t= document.getElementById('email-wrapper');\r\n\t\tthis.login\t\t\t= document.getElementById('login-button-wrapper');\r\n\t\tthis.passwordReset \t= document.getElementById('password-reset-form');\r\n\r\n\t\tthis.curScreen\t\t= this.creds;\r\n\t\t\r\n\t\tif(this.msgScreen.querySelector('.loader') == null){\r\n\t\t\tMain.showLoader(this.msgScreen.querySelector('.status-message'), false, 75);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Clear all inputs and shows the first screen\r\n\t */\r\n\tresetForm(){\t\t\r\n\t\tthis.reset();\r\n\r\n\t\tthis.showScreen(this.creds);\r\n\t\t\r\n\t\tthis.curScreen\t\t= this.creds;\r\n\t}\r\n\r\n\t/**\r\n\t * Show the loading screen\r\n\t */\r\n\tloadingScreen(message){\r\n\t\tthis.msgScreen.querySelector('.status-message').textContent\t= message;\r\n\r\n\t\tthis.curScreen.classList.add('hidden');\r\n\t\tthis.login.classList.add('hidden');\r\n\t\tthis.passwordReset.classList.add('hidden');\r\n\r\n\t\tthis.msgScreen.classList.remove('hidden');\r\n\t}\r\n\r\n\t/**\r\n\t * Resets the screen to the original login screen\r\n\t */\r\n\treset(){\r\n\t\tif(this.curScreen == undefined){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.curScreen.classList.remove('hidden');\r\n\t\tthis.msgScreen.classList.add('hidden');\r\n\r\n\t\tthis.passwordReset.classList.remove('hidden');\r\n\t}\r\n\r\n\t/**\r\n\t * Shows a particular screen\r\n\t */\r\n\tshowScreen(screen){\r\n\t\tif(this.curScreen != undefined){\r\n\t\t\tthis.curScreen.classList.add('hidden');\r\n\t\t\tthis.msgScreen.classList.add('hidden');\r\n\t\t}\r\n\r\n\t\tscreen.classList.remove('hidden');\r\n\r\n\t\tif(screen == this.twofa || screen == this.email){\r\n\t\t\tthis.login.classList.remove('hidden');\r\n\t\t}else{\r\n\t\t\tthis.login.classList.add('hidden');\r\n\t\t}\r\n\r\n\t\tscreen.querySelectorAll('input').forEach(el=>window.setTimeout(() => el.focus(), 0));\r\n\r\n\t\tthis.curScreen\t= screen;\r\n\t\t\r\n\t\t//hide messsages\r\n\t\tshowMessage('');\r\n\t}\r\n\t\r\n\t/**\r\n\t * Check if a valid username and password is submitted\r\n\t */\r\n\tasync verifyCreds(){\r\n\t\tthis.username\t= document.getElementById('username').value;\r\n\t\tlet password\t= document.getElementById('password').value;\r\n\r\n\t\t// Check if the fields are filled\r\n\t\tif(this.username != '' && password != ''){\r\n\t\t\tthis.passwordReset.classList.add('hidden');\r\n\r\n\t\t\tthis.loadingScreen( 'Verifying Credentials');\r\n\t\t}else{\r\n\t\t\tshowMessage('Please give an username and password!');\r\n\t\t\treturn;\r\n\t\t}\t\r\n\r\n\t\t// Make sure we have a internet connection\r\n\t\tawait Main.waitForInternet();\r\n\r\n\t\tlet formData\t= new FormData(this.form);\r\n\r\n\t\tlet response\t= await FormSubmit.fetchRestApi('login/check-cred', formData);\r\n\r\n\t\tif(response){\r\n\t\t\tif(response  && response != false){\r\n\t\t\t\tresponse\t= this.addMethods(response);\r\n\t\t\t}else{\r\n\t\t\t\tresponse \t= false;\r\n\t\t\t}\r\n\r\n\t\t\tif(!response) {\r\n\t\t\t\tthis.reset();\r\n\r\n\t\t\t\tshowMessage('Invalid login, try again');\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tthis.reset();\r\n\t\t}\r\n\t}\r\n\r\n\taddMethods(result){\t\t\t\r\n\t\tif(typeof(result) != 'object'){\r\n\t\t\t//something went wrong, reload the page\r\n\t\t\tlocation.reload();\r\n\t\t}\r\n\r\n\t\tif('redirect' in result){\r\n\t\t\t//redirect to the returned webpage\r\n\t\t\tlocation.href\t= result.redirect;\r\n\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tif(result instanceof Array){\r\n\r\n\t\t\tif(result.find(element => element == 'webauthn')){\r\n\t\t\t\tif(checkWebauthnAvailable()){\r\n\t\t\t\t\t//correct creds and webauthn enabled\r\n\t\t\t\t\tthis.verifyWebauthn(result);\r\n\t\t\t\t}else if(result.length == 1){\r\n\t\t\t\t\tshowMessage('You do not have a valid second login method for this device, please add one.');\r\n\t\t\t\t\tthis.requestLogin();\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis.showTwoFaFields(result);\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\t//correct creds and 2fa enabled\r\n\t\t\t\tthis.showTwoFaFields(result);\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Initiates and verifies a webauthentication login\r\n\t * @param {*} methods \r\n\t * @returns \r\n\t */\r\n\tasync verifyWebauthn(methods){\t\r\n\t\t//show webauthn messages\r\n\t\tthis.loadingScreen('Starting Webauthentication');\r\n\t\r\n\t\ttry{\r\n\t\t\tlet result\t= await webAuthVerification(this.username, this.msgScreen.querySelector('.status-message'));\r\n\t\r\n\t\t\tif(!result){\r\n\t\t\t\tthrow new Error( 'Webauthentication failed' );\r\n\t\t\t}\r\n\t\r\n\t\t\t//authentication success\r\n\t\t\tawait this.requestLogin();\r\n\t\t}catch (error){\t\r\n\t\t\tlet response\t= await FormSubmit.fetchRestApi('login/mark_bio_as_failed', '', false);\r\n\t\t\t\r\n\t\t\tconsole.log(response);\r\n\t\r\n\t\t\tif(methods.length == 1){\r\n\t\t\t\tshowMessage('Authentication failed, please setup an additional login factor.');\r\n\t\t\t\tthis.requestLogin();\r\n\t\t\t}else{\r\n\t\t\t\tconsole.error(error);\r\n\t\t\t\tlet message;\r\n\t\t\t\tif(error['message'] == \"No authenticator available\"){\r\n\t\t\t\t\tmessage = \"No biometric login for this device found. <br>Give verification code.\";\r\n\t\t\t\t}else{\r\n\t\t\t\t\tmessage = 'Web authentication failed, please give verification code.';\r\n\t\t\t\t}\r\n\t\t\t\tshowMessage(message);\r\n\t\r\n\t\t\t\t//Show other 2fa fields\r\n\t\t\t\tthis.showTwoFaFields(methods);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Performs the login action\r\n\t */\r\n\t//show loader\r\n\tasync requestLogin(){\r\n\t\tthis.loadingScreen('Logging in...');\r\n\r\n\t\tlet formData\t= new FormData(this.form);\r\n\t\tthis.form.querySelectorAll('.hidden [required]').forEach(el => {el.required = false});\r\n\t\tlet validity\t= this.form.reportValidity();\r\n\r\n\t\t//if not valid return\r\n\t\tif(!validity){\r\n\t\t\tthis.reset();\r\n\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tawait Main.waitForInternet();\r\n\r\n\t\tlet response\t= await FormSubmit.fetchRestApi('login/request_login', formData);\r\n\r\n\t\tif(!response){\r\n\t\t\tthis.reset();\r\n\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\t// We are logging in from an iframe\r\n\t\tif(window.self !== window.top){\r\n\r\n\t\t\t// change message\r\n\t\t\tconsole.log(window.parent.document.getElementById('iframe-loader'));\r\n\t\t\tconsole.log(window.parent.document);\r\n\t\t\tconsole.log(window.parent);\r\n\t\t\twindow.parent.document.getElementById('iframe-loader').textContent\t= 'Succesfully logged in, you may now close this popup';\r\n\r\n\t\t\t// Refresh the rest api nonce\r\n\t\t\twindow.parent.sim.restNonce\t= response.nonce;\r\n\r\n\t\t\t// Update user id\r\n\t\t\twindow.parent.sim.userId\t= response.id;\r\n\r\n\t\t\tconsole.log(window.parent.document.getElementById('iframe-loader'));\r\n\r\n\t\t\t// close all iframes\r\n\t\t\twindow.parent.document.querySelectorAll('iframe').forEach(el=>el.remove());\r\n\t\t}else{\r\n\t\t\tthis.loadingScreen('Succesfully logged in, redirecting...');\r\n\r\n\t\t\tif(response.redirect == ''){\r\n\t\t\t\t// refresh the page\r\n\t\t\t\tlocation.reload();\r\n\t\t\t}else{\r\n\t\t\t\t// go to the redirect page\r\n\t\t\t\tlocation.href = response.redirect;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * Display the form for the 2fa email or authenticator code\r\n\t */\r\n\tshowTwoFaFields(methods){\r\n\t\tif(methods.includes('email')){\r\n\t\t\tthis.requestEmailCode();\r\n\t\t}\r\n\r\n\t\t//show 2fa fields\r\n\t\tfor(const method of methods){\r\n\t\t\t//do not show webauthn\r\n\t\t\tif(method == 'webauthn'){\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif(method == 'email'){\r\n\t\t\t\tthis.showScreen(this.email);\r\n\t\t\t}else{\r\n\t\t\t\tthis.showScreen(this.twofa);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Request email code for 2fa login\r\n\t */\r\n\tasync requestEmailCode(){\r\n\t\t// Show the email screen\r\n\t\tthis.showScreen(this.email);\r\n\r\n\t\tlet loader\t\t\t\t= Main.showLoader(null, false, 20, '', true);\r\n\t\tshowMessage(`Sending e-mail... ${loader}`);\r\n\r\n\t\tlet formData\t= new FormData();\r\n\t\tformData.append('username', this.username);\r\n\t\r\n\t\tlet response\t= await FormSubmit.fetchRestApi('login/request_email_code', formData, false);\r\n\t\t\r\n\t\tif(response){\r\n\t\t\tshowMessage(response);\r\n\t\t}else{\r\n\t\t\tshowMessage(`Sending e-mail failed`);\r\n\t\t}\r\n\t}\r\n\r\n\t//request password reset e-mail\r\n\tasync resetPassword(target){\t\t\r\n\t\tlet form \t\t\t= target.closest('form');\r\n\r\n\t\tlet button\t\t\t= form.querySelector('#lost-pwd-link');\r\n\r\n\t\tlet extraElements\t= form.querySelector('div.form-elements');\r\n\r\n\t\t// If the extra elements are not present, create them\r\n\t\tif(extraElements != null && extraElements.innerHTML != '' && extraElements.classList.contains('hidden')){\r\n\t\t\t// Hide the login form\r\n\t\t\tdocument.getElementById('loginform').classList.add('hidden');\r\n\r\n\t\t\tif(form.querySelector(`[name='username']`) == null){\r\n\t\t\t\textraElements.innerHTML\t= `<label class=\"form-label\">\r\n\t\t\t\t\tUsername<br>\r\n\t\t\t\t\t<input type=\"text\" name=\"username\" id=\"username\" class=\"form-control\" value=\"${this.username}\" required>\r\n\t\t\t\t</label><br>`+extraElements.innerHTML;\r\n\t\t\t}\r\n\r\n\t\t\t// Show the form\r\n\t\t\textraElements.classList.remove('hidden');\r\n\r\n\t\t\tbutton.dataset.orghtml\t= button.innerHTML;\r\n\t\t\tbutton.innerHTML\t= 'Request Password Reset';\r\n\r\n\t\t\tbutton.classList.add('button');\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif(this.username == ''){\r\n\t\t\tMain.displayMessage('Specify your username first', 'error');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tbutton.classList.add('hidden');\r\n\t\tlet loader = Main.showLoader(button, false, 50, 'Requesting Password Reset...   ');\r\n\r\n\t\tlet formData\t= new FormData(form);\r\n\t\tformData.append('username', this.username);\r\n\t\t\r\n\t\tlet response\t= await FormSubmit.fetchRestApi('login/request_pwd_reset', formData);\r\n\r\n\t\tif (response) {\r\n\t\t\tMain.displayMessage(response, 'success');\r\n\t\t\t\r\n\t\t\t// Show the login form\r\n\t\t\tdocument.getElementById('loginform').classList.remove('hidden');\r\n\r\n\t\t\textraElements.classList.add('hidden');\r\n\r\n\t\t\tbutton.innerHTML\t= button.dataset.orghtml;\r\n\t\t\tbutton.classList.remove('button');\r\n\t\t}\r\n\r\n\t\tloader.remove();\r\n\t\tbutton.classList.remove('hidden');\r\n\r\n\t}\r\n\r\n\t// request a new user account\r\n\tasync requestAccount(target){\r\n\t\tlet form \t\t= target.closest('form');\r\n\r\n\t\t// Show loader\r\n\t\tform.querySelector('.loader-wrapper').classList.remove('hidden');\r\n\r\n\t\tlet formData\t= new FormData(form);\r\n\r\n\t\tlet response\t= await FormSubmit.fetchRestApi('login/request_user_account', formData);\r\n\t\t\r\n\t\tif(response){\r\n\t\t\tMain.displayMessage(response);\r\n\t\t}\r\n\r\n\t\t// reset form \r\n\t\tform.reset();\r\n\r\n\t\t// Hide loader\r\n\t\tform.querySelector('.loader-wrapper').classList.add('hidden');\r\n\t}\r\n\r\n\t// Show the modal with the login form\r\n\topenLoginModal(){\r\n\t\t// Make sure the menu is closed\r\n\t\tcloseMobileMenu();\r\n\r\n\t\t//prevent page scrolling\r\n\t\tdocument.querySelector('body').style.overflowY = 'hidden';\r\n\r\n\t\tthis.modal\t= document.getElementById('login-modal');\r\n\t\tthis.modal.style.display = 'block';\r\n\r\n\t\tthis.modal.classList.remove('hidden');\r\n\r\n\t\tthis.resetForm();\t\t\r\n\t}\r\n\t\r\n\t//prevent zoom in on login form on a iphone\r\n\taddMaximumScaleToMetaViewport(){\r\n\t\tlet el = document.querySelector('meta[name=viewport]');\r\n\t\r\n\t\tif (el !== null) {\r\n\t\t\tlet content\t= el.getAttribute('content');\r\n\t\t\tlet re \t\t= /maximum\\-scale=[0-9\\.]+/g;\r\n\t\t\r\n\t\t\tif (re.test(content)) {\r\n\t\t\t\tcontent = content.replace(re, 'maximum-scale=1.0');\r\n\t\t\t} else {\r\n\t\t\t\tcontent = [content, 'maximum-scale=1.0'].join(', ')\r\n\t\t\t}\r\n\t\t\r\n\t\t\tel.setAttribute('content', content);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// SHow the login button\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n\t//check if the current browser supports webauthn\r\n\tcheckWebauthnAvailable();\r\n\r\n\tdocument.querySelectorAll('.login.hidden').forEach(el=>{\r\n\t\tel.classList.remove('hidden');\r\n\t});\t\r\n\r\n\tsim.login = new login();\r\n});"],"names":["showMessage","message","document","querySelector","innerHTML","DOMPurify","sanitize","intervalId","checkCount","async","refreshQrCode","formData","FormData","wrapper","getElementById","qrCodeImage","console","log","append","dataset","token","key","response","FormSubmit","fetchRestApi","wrapperinnerHTML","oldtoken","clearInterval","Main","showLoader","startsWith","location","href","reload","login","_browserSupportsWebAuthnInternals","stubThis","undefined","globalThis","PublicKeyCredential","value","Error","constructor","code","cause","name","super","Object","defineProperty","this","enumerable","configurable","writable","createNewAbortSignal","controller","abortError","abort","newController","AbortController","signal","cancelCeremony","buffer","bytes","Uint8Array","str","charCode","String","fromCharCode","btoa","replace","base64URLString","base64","padLength","length","padded","padEnd","binary","atob","ArrayBuffer","i","charCodeAt","_browserSupportsWebAuthnAutofillInternals","descriptor","id","transports","attachments","attachment","indexOf","webAuthVerification","username","optionsJSON","sim","loadingScreen","assertionResponse","options","challenge","warn","useBrowserAutofill","verifyBrowserAutofillInput","allowCredentials","map","publicKey","getOptions","Promise","resolve","globalPublicKeyCredential","isConditionalMediationAvailable","browserSupportsWebAuthnAutofill","querySelectorAll","mediation","credential","navigator","credentials","get","err","error","AbortSignal","effectiveDomain","hostname","test","rpId","identifyAuthenticationError","rawId","type","userHandle","authenticatorData","clientDataJSON","signature","clientExtensionResults","getClientExtensionResults","authenticatorAttachment","startAuthentication","form","JSON","stringify","verified","window","isUserVerifyingPlatformAuthenticatorAvailable","then","result","startConditionalRequest","conditionalMediationSupported","requestLogin","reset","checkWebauthnAvailable","webauthnSupported","init","Proxy","URLSearchParams","search","searchParams","prop","checkIsIOS","addMaximumScaleToMetaViewport","eventListeners","addEventListener","e","creds","stopImmediatePropagation","curScreen","disabled","verifyCreds","email","twofa","event","target","matches","openLoginModal","closest","ev","tagName","parentNode","toggle","title","togglePassworView","resetPassword","verifyWebauthn","requestAccount","classList","add","firstChild","setInterval","remove","userAgent","MSStream","msgScreen","passwordReset","resetForm","showScreen","textContent","screen","forEach","el","setTimeout","focus","password","waitForInternet","addMethods","redirect","Array","find","element","showTwoFaFields","methods","required","reportValidity","self","top","parent","restNonce","nonce","userId","includes","requestEmailCode","method","button","extraElements","contains","orghtml","displayMessage","loader","ariaExpanded","style","overflowY","modal","display","content","getAttribute","re","join","setAttribute"],"sourceRoot":""}